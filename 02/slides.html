<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Veljko Petrović">
  <title>Operativni Sistemi - Konkurentno programiranje</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="slides.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Operativni Sistemi - Konkurentno programiranje</h1>
  <p class="author">Veljko Petrović</p>
  <p class="date">Februar, 2023</p>
</section>

<section>
<section id="primeri-štetnog-preplitanja" class="title-slide slide level1">
<h1>Primeri štetnog preplitanja</h1>

</section>
<section id="svojstva-konkurentnih-programa" class="slide level2">
<h2>Svojstva konkurentnih programa</h2>
<ul>
<li>Mešanje izvršavanja raznih niti i obrađivača prekida naziva se preplitanje (interleaving).</li>
<li>Preplitanje niti i obrada prekida imaju slučajan karakter jer unapred nije poznato kada će se desiti prekid i preključivanje.</li>
<li>Stohastično izvršavanje konkurentnih programa može da menja rezultate izvršavanja od slučaja do slučaja, što može dovesti do pojave štetnog preplitanja.</li>
</ul>
</section>
<section id="primeri-štetnog-preplitanja-1" class="slide level2">
<h2>Primeri štetnog preplitanja</h2>
<ul>
<li>Primeri štetnog preplitanja su mogući i u OS (sistemski pozivi su niti i mogu se preplitati sa obrađivačima prekida).</li>
<li>Rukovanje pozicijom kursora je dobar primer štetnog preplitanja.</li>
</ul>
</section>
<section id="rukovanje-pozicijom-kursora" class="slide level2">
<h2>Rukovanje pozicijom kursora</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Position <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    Position<span class="op">();</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> set<span class="op">(</span><span class="dt">int</span> new_x<span class="op">,</span><span class="dt">int</span> new_y<span class="op">);</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> current_x<span class="op">,</span><span class="dt">int</span><span class="op">*</span> current_y<span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>Position<span class="op">::</span>Position<span class="op">(){</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="rukovanje-pozicijom-kursora-1" class="slide level2">
<h2>Rukovanje pozicijom kursora</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Position<span class="op">::</span>set<span class="op">(</span><span class="dt">int</span> new_x<span class="op">,</span> <span class="dt">int</span> new_y<span class="op">){</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> new_x<span class="op">;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> new_y<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Position<span class="op">::</span>get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> current_x<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> current_y<span class="op">){</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>current_x <span class="op">=</span> x<span class="op">;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>current_y <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Position position<span class="op">;</span></span></code></pre></div>
</section>
<section id="rukovanje-pozicijom-kursora-2" class="slide level2">
<h2>Rukovanje pozicijom kursora</h2>
<ul>
<li>Neka operacija <code>position.set()</code> bude na raspolaganju samo obrađivaču prekida koji u okviru operativnog sistema registruje izmene pozicije kursora.</li>
<li>Neka operacija <code>position.get()</code> bude na raspolaganju procesima iz korisničkog sloja.</li>
<li>Tada je moguće da u toku izvršavanja operacije <code>position.get()</code> proces bude prekinut radi obrade prekida, koja poziva operaciju <code>position.set()</code>.</li>
<li>Ako se to desi nakon izvršavanja prvog iskaza dodele iz tela operacije <code>position.get()</code> a pre izvršavanja drugog iskaza dodele iz njenog tela, tada će rezultat izvršavanja ove operacije biti pogrešan.</li>
</ul>
</section>
<section id="rukovanje-slobodnim-baferima" class="slide level2">
<h2>Rukovanje slobodnim baferima</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> List_member <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> List <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> first<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    List<span class="op">()</span> <span class="op">:</span> first<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{};</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">);</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlink<span class="op">();</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> List<span class="op">::</span>link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">){</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    member<span class="op">-&gt;</span>next<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    first<span class="op">=</span>member<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="rukovanje-slobodnim-baferima-1" class="slide level2">
<h2>Rukovanje slobodnim baferima</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>List_member<span class="op">*</span> List<span class="op">::</span>unlink<span class="op">(){</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlinked<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    unlinked<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>first <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        first<span class="op">=</span>first<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unlinked<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>List list<span class="op">;</span></span></code></pre></div>
</section>
<section id="rukovanje-slobodnim-baferima-2" class="slide level2">
<h2>Rukovanje slobodnim baferima</h2>
<ul>
<li>Neka su operacije <code>list.link()</code> i <code>list.unlink()</code> na raspolaganju samo modulu za rukovanje datotekama i neka se pozivaju iz operacija ovog modula.</li>
<li>Tada je moguće da izvršavanje operacije <code>list.unlink()</code> bude pokrenuto u toku aktivnosti niti nekog procesa u modulu za rukovanje datotekama.</li>
<li>Kao rezultat izvršavanja ove operacije na steku pomenute niti nastane primerak njene lokalne promenljive <code>unlinked</code></li>
<li>Izvršavanje iskaza <code>unlinked = first</code></li>
<li>smešta u ovaj primerak lokalne promenljive adresu prvog slobodnog bafera iz liste bafera, jasno, kada takav bafer postoji.</li>
</ul>
</section>
<section id="rukovanje-slobodnim-baferima-3" class="slide level2">
<h2>Rukovanje slobodnim baferima</h2>
<ul>
<li>Neka, nakon izvršavanja prethodnog iskaza, pod uticajem obrade prekida dođe do preključivanja procesora na nit drugog procesa. Tada, u toku aktivnosti niti ovog procesa, može doći do pokretanja još jednog izvršavanja operacije <code>list.unlink()</code>.</li>
<li>Tako na steku i ove druge niti nastaje njen primerak lokalne promenljive <code>unlinked</code>.</li>
<li>Posledica ovakvog sleda događaja je da posmatrana dva procesa koriste isti bafer. To neminovno dovodi do fatalnog ishoda.</li>
<li>Prema tome, preplitanje dva izvršavanja operacije <code>list.unlink()</code>, je štetno. Isto važi i za preplitanje izvršavanja operacija <code>list.link()</code> i <code>list.unlink()</code> kao i <code>list.link()</code> i <code>list.link()</code></li>
</ul>
</section>
<section id="rukovanje-komunikacionim-baferom" class="slide level2">
<h2>Rukovanje komunikacionim baferom</h2>
<ul>
<li>Štetna međusobna preplitanja niti su moguća i za niti koje pripadaju istom procesu.</li>
<li>Ovakva saradnja se može ostvariti tako što jedna od niti šalje podatke drugoj niti.</li>
<li>Takva razmena podataka između niti se obično obavlja posredstvom komunikacionog bafera.</li>
<li>Nit koja puni ovaj bafer podacima ima ulogu proizvođača (podataka), a nit koja prazni ovaj bafer ima ulogu potrošača (podataka).</li>
<li>U pojednostavljenom slučaju, rukovanje komunikacionim baferom obuhvata punjenje: <code>put()</code> celog bafera, kao i pražnjenje: <code>get()</code> celog bafera.</li>
</ul>
</section>
<section id="rukovanje-komunikacionim-baferom-1" class="slide level2">
<h2>Rukovanje komunikacionim baferom</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">int</span> BUFFER_SIZE <span class="op">=</span> <span class="dv">512</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Buffer <span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> content<span class="op">[</span>BUFFER_SIZE<span class="op">];</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  Buffer<span class="op">()</span> <span class="op">{};</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">);</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">);</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Buffer<span class="op">::</span>put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">){</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> BUFFER_SIZE<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        content<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">*</span>c<span class="op">++;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="rukovanje-komunikacionim-baferom-2" class="slide level2">
<h2>Rukovanje komunikacionim baferom</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Buffer<span class="op">::</span>get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">){</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> BUFFER_SIZE<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>c<span class="op">++</span> <span class="op">=</span> content<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>Buffer buffer<span class="op">;</span></span></code></pre></div>
</section>
<section id="c-haiku" class="slide level2">
<h2>C haiku</h2>
<p><img data-src="img/2023-02-27-22-25-58.png" /></p>
</section>
<section id="rukovanje-komunikacionim-baferom-3" class="slide level2">
<h2>Rukovanje komunikacionim baferom</h2>
<ul>
<li>Operaciju <code>buffer.put()</code> poziva nit proizvođač.</li>
<li>Operaciju <code>buffer.get()</code> poziva nit potrošač.</li>
<li>U ovoj situaciji moguće je, da se desi prekid sata za vreme aktivnosti proizvođača u operaciji <code>buffer.put()</code>.</li>
<li>Ako operacija <code>buffer.get()</code> bude pozvana u toku aktivnosti potrošača, tada postoji mogućnost da potrošač preuzme sadržaj delimično popunjenog bafera.</li>
</ul>
</section></section>
<section>
<section id="sprečavanje-štetnih-preplitanja" class="title-slide slide level1">
<h1>Sprečavanje štetnih preplitanja</h1>

</section>
<section id="međusobna-isključivost" class="slide level2">
<h2>Međusobna isključivost</h2>
<ul>
<li>Promenljive kojima pristupaju više niti ili niti i obrađivači prekida istovremeno (position, list i buffer) se nazivaju <strong>deljene promenljive</strong>, a klase koje opisuju te promenljive <strong>deljene klase</strong>.</li>
<li>Deljene klase su pravljene pod pretostavkom da se rukovanja deljenim promenljivim obavljaju sekvencijalno odnosno strogo jedna za drugom.</li>
<li>Štetna preplitanja negiraju pomenutu pretpostavku jer dopuštaju da novo izvršavanje neke operacije deljene promenljive započne pre nego što se završilo već započeto izvršavanje neke od operacija te promenljive.</li>
<li>Problem štetnih preplitanja ne postoji ako se obezbedi međusobna isključivost (mutual exclusion) izvršavanja operacija deljenih promenljvih.</li>
</ul>
</section>
<section id="kritične-sekcije-i-sinhronizacija" class="slide level2">
<h2>Kritične sekcije i sinhronizacija</h2>
<ul>
<li>Tela operacija deljenih klasa ili delovi ovih tela, čije izvršavanje je kritično za konzistentnost deljenih promenljvih, se nazivaju <strong>kritične sekcije</strong>.</li>
<li>Međusobna isključivost kritičnih sekcija se ostvaruje sinhronizacijom pristupa.</li>
<li>Pored obične sinhronizacije postoji i uslovna sinhronizacija.</li>
</ul>
</section>
<section id="fundamentalna-rešenja-problema-međusobne-isključivosti" class="slide level2">
<h2>Fundamentalna Rešenja problema međusobne isključivosti</h2>
<ul>
<li>Postoje dva fundamentalna pristupa problemu međusobne isključivosti:
<ul>
<li>Pristup baziran na softveru</li>
<li>Pristup baziran na hardveru</li>
</ul></li>
</ul>
</section>
<section id="atomski-regioni" class="slide level2">
<h2>Atomski regioni</h2>
<ul>
<li>U primeru rukovanja pozicijom kursora, štetna preplitanja nastupaju kao posledica obrade prekida.</li>
<li>Atomski regioni omogućavaju neprekidnost izvršavanja unutar kritičnih sekcija deljene promenljive.</li>
<li>Onemogućenje prekida odlaže obradu novih prekida i usporava reakciju procesora, pa atomski regioni treba da budu što kraći.</li>
</ul>
</section>
<section id="propusnice-i-isključivi-regioni" class="slide level2">
<h2>Propusnice i isključivi regioni</h2>
<ul>
<li>Propusnice su drugi način ostvarenja međusobne isključivosti kritičnih sekcija.</li>
<li>Propusnica može biti slobodna ili zauzeta.</li>
<li>Samo jedna nit od svih niti koje se takmiče za propusnicu dobija istu i ulazi u kritičnu sekciju, dok sve ostale niti zaustavljaju svoju aktivnost i prelaze u stanje “čeka”.</li>
<li>Kada nit koja napušta kritičnu sekciju oslobodi propusnicu (vrati), neka sledeća nit dobija propusnicu i prelazi iz stanja “čeka” u stanje “spremna”.</li>
<li>Nit, koja tada dobije propusnicu, odmah prelazi iz stanja “čeka” u stanje “spremna”, ali u kritičnu sekciju ulazi tek kada postane aktivna (odnosno, kada se procesor preključi na nju).</li>
</ul>
</section>
<section id="propusnice-i-isključivi-regioni-1" class="slide level2">
<h2>Propusnice i isključivi regioni</h2>
<ul>
<li>Rukovanje propusnicom deljene promenljive je, takođe, ugroženo štetnim preplitanjima.</li>
<li>Zbog toga se konzistentnost propusnica mora zaštititi.</li>
<li>To se može učiniti kroz algoritam ili kroz hardversku podršku</li>
</ul>
</section>
<section id="algoritmi-koji-štite-propusnicu" class="slide level2">
<h2>Algoritmi koji štite propusnicu</h2>
<ul>
<li>Ovo je plodno polje istraživanja koje je <em>naročito</em> važno ako se bavite distribuiranim sistemima (nešto više o ovome kasnije)</li>
<li>Ovde ćemo baciti pogled na Lamportovo rešenje poznato još i kao “Lamportova Pekara”</li>
<li>Lamportova Pekara je mehanizam gde zamišljamo da imamo pekaru (radila bi i neka druga prodavnica) gde mušterije uzmu broj da bi ušle u prodavnicu.</li>
<li>Na ulazu je znak koji prikazuje koji se broj uslužuje</li>
</ul>
</section>
<section id="lamportova-pekara" class="slide level2">
<h2>Lamportova Pekara</h2>
<ul>
<li>Algoritam je onda da uzmemo broj i čekamo (bukvalno čekanje: koristimo petlju za čekanje - tehnika koja je još poznata i kao spinlock ili busy-wait) dok naš broj nije ‘na redu’</li>
<li>Pošto se svi možemo složiti oko toga koji je broj veći ili manji, dok god možemo da delimo memoriju, možemo da se sinhronizujemo</li>
</ul>
</section>
<section id="lamportova-pekara-1" class="slide level2">
<h2>Lamportova Pekara</h2>
<ul>
<li>Algoritam se mora adaptirati za upotrebu na računaru (a ne u pekari) ali centralna ideja je ista</li>
<li>Uvešćemo prvo dva niza, <code>Choosing</code> i <code>Number</code></li>
<li>Prvi je bool niz koji je 1 ako je neka nit u procesu biranja broja</li>
<li>Drugi je niz brojeva koje niti uzimaju</li>
</ul>
</section>
<section id="lamportova-pekara---pseudokod" class="slide level2">
<h2>Lamportova Pekara - pseudokod</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> choosing<span class="op">[</span>NUM_THREADS<span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="kw">false</span><span class="op">};</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> number<span class="op">[</span>NUM_THREADS<span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> lock<span class="op">(</span><span class="dt">int</span> i<span class="op">){</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  choosing<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  number<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> max<span class="op">(</span>number<span class="op">);</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  choosing<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> NUM_THREADS<span class="op">;</span> j<span class="op">++){</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>choosing<span class="op">[</span>j<span class="op">]);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span>number<span class="op">[</span>j<span class="op">]</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>number<span class="op">[</span>j<span class="op">]</span> <span class="op">&lt;</span> number<span class="op">[</span>i<span class="op">])</span> <span class="op">||</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>number<span class="op">[</span>j<span class="op">]</span> <span class="op">==</span> number<span class="op">[</span>i<span class="op">]</span> <span class="op">&amp;&amp;</span> j <span class="op">&lt;</span> pid<span class="op">)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="lamportova-pekara-2" class="slide level2">
<h2>Lamportova Pekara</h2>
<ul>
<li>Primetite da je ograničenje Lamportove pekare da može da se desi da dve niti dobiju isti broj</li>
<li>To nije problem: u tom slučaju broj <strong>niti</strong> postaje prioritet</li>
<li>Jedino što je onda potrebno je imati brojeve niti koje se ne ponavaljaju</li>
</ul>
</section>
<section id="lamportova-pekara---pseudokod-1" class="slide level2">
<h2>Lamportova Pekara - pseudokod</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> unlock<span class="op">(</span><span class="dt">int</span> i<span class="op">){</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  number<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> nit<span class="op">(</span><span class="dt">int</span> pid<span class="op">){</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span><span class="op">(</span><span class="kw">true</span><span class="op">){</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    lock<span class="op">(</span>pid<span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Kritična sekcija</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    unlock<span class="op">(</span>pid<span class="op">);</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="ograničenje-lamportove-pekare-i-sličnih-algoritama" class="slide level2">
<h2>Ograničenje Lamportove pekare i sličnih algoritama</h2>
<ul>
<li>Glavni problem sa svim algoritmima ove vrste jeste što se zasnivaju na tome da se kod izvršava <em>tačno kako piše</em></li>
<li>Ovo apsolutno nije nešto u šta možemo da se uzdamo na modernim sistemima gde je često izvršavanje koda van redosleda</li>
<li>Ako imamo izvršavanje koda van redosleda, onda algoritmi ovog tipa <em>neće raditi.</em></li>
</ul>
</section>
<section id="hardverska-podrška" class="slide level2">
<h2>Hardverska podrška</h2>
<ul>
<li>Hardverska podrška je ono što se koristi na jedinstvenim računarima</li>
<li>Jednostavno je, brzo i efektno</li>
<li>Na procesorima jednostrukog tipa se koriste <em>atomski regioni</em> koji su konstruisani tako što se zabrani obrada prekida</li>
<li>Procesori sa više sistemskih niti zahtevaju nešto malo komplikovanije.</li>
</ul>
</section>
<section id="zabrana-prekida" class="slide level2">
<h2>Zabrana prekida</h2>
<ul>
<li>Ako imamo jednostruk procesor jedini način na koji on može prestati da izvršava sekvencu instrukcija koju je uzeo da izvršava jeste da se desi prekid</li>
<li>Taj prekid može da nešto promeni i da vrati izvršavanje (kao što je slučaj sa obrađivačem za kursor ili vreme), ali jednako lako može i da potpuno promeni šta se izvršava budući da obrađivač prekida može da promeni pointer instrukcija i sadržaj registara i steka i time potpuno i permanentno izmeni šta sistem radi.</li>
</ul>
</section>
<section id="zabrana-prekida-1" class="slide level2">
<h2>Zabrana prekida</h2>
<ul>
<li>Ako <em>zabranimo</em> prekid što se relativno lako može uraditi kroz instrukciju procesora koja tome služi, onda garantujemo da nas niko drugi neće prekinuti</li>
<li>Ako nema potrebe da se bavimo nečim drugim, mi predpostavljamo da koristimo baš ovaj pristup, mada se on u praksi ne koristi.</li>
</ul>
</section>
<section id="šta-na-procesorima-sa-više-sistemskih-niti" class="slide level2">
<h2>Šta na procesorima sa više sistemskih niti?</h2>
<ul>
<li>Jedan od metoda jeste da se zabrane prekidi <em>i</em> zaključa memorijska magistrala</li>
<li>Ovim se garantuje da niti može da se desi prekid nit druga nit može da dirne memoriju</li>
<li>U praksi ovo je previše sporo</li>
<li>Umesto toga, kada je samo potrebna međusobna isključivost između dve korisničke niti onda se koriste posebne instrukcije koje implementiraju sve što je potrebno da bi se implementirala propusnica.</li>
</ul>
</section>
<section id="poredi-i-zameni" class="slide level2">
<h2>Poredi i zameni</h2>
<ul>
<li>Poredi i zameni (eng. Compare and Swap) je instrukcija koja postoji na nekim arhitekturama i koristi se kao gradivni element da implementira različite primitive sinhronizacije.</li>
<li>Na Intel arhitekturi ovo se zove CMPXCHNG i (uz prefiks LOCK) omogućava da se vrlo jednostavno napravi struktura koja bezbedno upravlja memorijom propusnice</li>
<li>Ako pogledamo uputstvo možemo da vidimo kako je to Intel implementirao.</li>
</ul>
</section>
<section id="citat-iz-intel-uputstva-za-x86-64-arhitekturu-7.3.1.2" class="slide level2">
<h2>Citat iz Intel uputstva za x86-64 arhitekturu 7.3.1.2</h2>
<p>“The CMPXCHG (compare and exchange) and CMPXCHG8B (compare and exchange 8 bytes) instructions are used to synchronize operations in systems that use multiple processors. The CMPXCHG instruction requires three operands: a source operand in a register, another source operand in the EAX register, and a destination operand. If the values contained in the destination operand and the EAX register are equal, the destination operand is replaced with the value of the other source operand (the value not in the EAX register). Otherwise, the original value of the destination operand is loaded in the EAX register.”</p>
</section>
<section id="citat-iz-intel-uputstva-za-x86-64-arhitekturu-7.3.1.2-1" class="slide level2">
<h2>Citat iz Intel uputstva za x86-64 arhitekturu 7.3.1.2</h2>
<p>“The status flags in the EFLAGS register reflect the result that would have been obtained by subtracting the destination operand from the value in the EAX register. The CMPXCHG instruction is commonly used for testing and modifying semaphores. It checks to see if a semaphore is free. If the semaphore is free, it is marked allocated; otherwise it gets the ID of the current owner. This is all done in one uninterruptible operation. In a single-processor system, the CMPXCHG instruction eliminates the need to switch to protection level 0 (to disable interrupts) before executing multiple instructions to test and modify a semaphore. For SMP systems, CMPXCHG can be combined with the LOCK prefix to perform the compare and exchange operation atomically.”</p>
</section>
<section id="kako-dalje" class="slide level2">
<h2>Kako dalje</h2>
<ul>
<li>Nije bitno (mnogo) koja tehnika se koristi da se implementira propusnica</li>
<li>Bitno je da radi</li>
<li>Za naše potrebe, ako nas baš ne zanima neka varijacija na temu, plan će da se pratvaramo da imamo jednostruk procesor gde koristimo zabranu prekida zato što je to najprostije za razumevanje.</li>
</ul>
</section>
<section id="propusnice-i-isključivi-regioni-2" class="slide level2">
<h2>Propusnice i isključivi regioni</h2>
<ul>
<li>Interesantno je uočiti da preključivanja u isključivim regionima omogućuju pojavu štetnih preplitanja, ali i omogućuju njihovo sprečavanje.</li>
<li>Tako, ako nit, čiju aktivnost je omogućilo preključivanje, pokuša da uđe u isključivi region deljene promenljive sa zauzetom propusnicom, tada opet preključivanje dovodi do zaustavljanja aktivnosti ove niti.</li>
<li>Prema tome, prvo preključivanje je stvorilo uslove za pojavu štetnog preplitanja, a drugo preključivanje je sprečilo tu pojavu.</li>
</ul>
</section>
<section id="poželjne-osobine-konkurentnih-programa" class="slide level2">
<h2>Poželjne osobine konkurentnih programa</h2>
<ul>
<li>Poželjne osobine konkurentnih programa uvode:
<ul>
<li>Tvrdnju isključivanja nepoželjnog (safety property).</li>
<li>Tvrdnju uključivanja poželjnog (liveness property).</li>
</ul></li>
<li>Primer tvrdnje isključivanja nepoželjnog je tvrdnja da se u izvršavanjima konkurentnog programa ne javlja nekonzistentnost date deljene promenljive.</li>
<li>Primer tvrdnje uključivanja poželjnog je tvrdnja da se u toku izvršavanja konkurentnog programa dese svi zatraženi ulasci u dati isključivi region.</li>
</ul>
</section>
<section id="poželjne-osobine-konkurentnih-programa-1" class="slide level2">
<h2>Poželjne osobine konkurentnih programa</h2>
<ul>
<li>Za konkurentni program se može reći da ima neku od poželjnih osobina samo ako se dokaže (na neformalan ili formalan način) da važi tvrdnja kojoj pomenuta osobina odgovara.</li>
<li>Ovakvo rezonovanje o ispravnosti konkurentnog programa je neophodno, jer slučajna priroda preplitanja može da bude uzrok nedeterminističkog (nepredvidivog) izvršavanja konkurentnog programa.</li>
</ul>
</section>
<section id="poželjne-osobine-konkurentnih-programa-2" class="slide level2">
<h2>Poželjne osobine konkurentnih programa</h2>
<ul>
<li>U takvoj situaciji, ponovljena izvršavanja konkurentnog programa, u toku kojih se obrađuju isti podaci, ne moraju da imaju isti ishod.</li>
<li>Zbog toga, provera ispravnosti konkurentnog programa ne može da se zasniva samo na pokazivanju da pojedina izvršavanja konkurentnog programa imaju ispravan rezultat, jer tačan rezultat, dobijen u jednom ili više izvršavanja, ne isključuje mogućnost postojanja izvršavanja koja za iste ulazne podatke daju netačan rezultat.</li>
</ul>
</section>
<section id="programski-jezici-za-konkurentno-programiranje" class="slide level2">
<h2>Programski jezici za konkurentno programiranje</h2>
<ul>
<li>Konkurentno programiranje se razlikuje od sekvencijalnog po rukovanju nitima i deljenim promenljivama.</li>
<li>Konkurentni programski jezik može nastati kao rezultat pravljenja potpuno novog programskog jezika ili kao rezultat proširenja postojećeg sekvencijalnog programskog jezika konkurentnim iskazima.</li>
<li>Konkurentna biblioteka omogućuje da se za konkurentno programiranje koristi već postojeći, poznat programski jezik.</li>
</ul>
</section>
<section id="uvod-u-konkurentnu-biblioteku-c" class="slide level2">
<h2>Uvod u konkurentnu biblioteku C++</h2>
<ul>
<li>Međunarodni standard C++11 predviđa rukovanje nitima i deljenim promenljivama.</li>
<li>Implementacije C++11 standarda i kasnijih revizija su dužne da pruže nekakvu implementaciju ovih standardnih osobina jezika</li>
<li>Na Linux platformi GCC počevši od verzije ~5 podržava sve što je potrebno</li>
<li>Potrebna je pomoć operativnog sistema da se niti implementiraju kako valja</li>
<li>Ta pomoć se pruža preko POSIX Threads (pthreads) mehanizma.</li>
</ul>
</section>
<section id="klasa-thread" class="slide level2">
<h2>Klasa <code>thread</code></h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_example<span class="op">(){</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;ZADAJ VREDNOST BROJA X&quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    cin <span class="op">&gt;&gt;</span> x<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl <span class="op">&lt;&lt;</span> <span class="st">&quot;x = &quot;</span> <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    thread example<span class="op">(</span>thread_example<span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    example<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>   <span class="co">//example.detach();</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-thread-1" class="slide level2">
<h2>Klasa <code>thread</code></h2>
<ul>
<li>Sve što nam je potrebno jeste da napravimo instancu klase <code>thread</code> kojoj prosledimo funkciju koja će biti telo niti</li>
<li>U tom trenutku nit počinje da radi</li>
<li>Ono što nam je ostalo i što moramo da uradimo jeste da definišemo odnos između niti koja je pokrenula tu nit (sve niti pokreće neka druga nit osim niti koja izvršava ‘main’ koju dobijamo za džabe od operativnog sistema)</li>
<li>Imamo dva izbora: <code>join</code> i <code>detach</code></li>
</ul>
</section>
<section id="join-i-detach" class="slide level2">
<h2><code>join</code> i <code>detach</code></h2>
<ul>
<li>Prva opcija kaže da će nit koja je pokrenula drugu nit (nit-roditelj i nit-dete su tipični termini) da pauzira izvršavanje dok nit-dete ne terminira.</li>
<li>Većinu vremena ovo je tačno ono što želimo zato što ne želimo da se nit <code>main</code> terminira (zajedno sa programom) dok nam se sve niti nisu završile.</li>
<li>Druga opcija služi kada nam ne treba da čekamo da se nit-dete završi (možda se izvršava u beskonačnoj petlji) i jednostavno terminiramo program kada stignemo do kraja <code>main</code> niti.</li>
</ul>
</section>
<section id="primer-štetnog-preplitanja" class="slide level2">
<h2>Primer štetnog preplitanja</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    thread example1<span class="op">(</span>thread_example<span class="op">);</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    thread example2<span class="op">(</span>thread_example<span class="op">);</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    example1<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    example2<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="primer-štetnog-preplitanja-1" class="slide level2">
<h2>Primer štetnog preplitanja</h2>
<ul>
<li>Šta je ovde deljeni resurs?</li>
<li>Šta izaziva štetno preplitanje?</li>
<li>Kako bi se manifestovalo?</li>
</ul>
</section>
<section id="sprečavanje-štetnog-preplitanja-1" class="slide level2">
<h2>Sprečavanje štetnog preplitanja 1</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mutex terminal<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_example<span class="op">(){</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    terminal<span class="op">.</span>lock<span class="op">();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;ZADAJ VREDNOST BROJA X&quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    cin <span class="op">&gt;&gt;</span> x<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl <span class="op">&lt;&lt;</span> <span class="st">&quot;X = &quot;</span> <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    terminal<span class="op">.</span>unlock<span class="op">();</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="sprečavanje-štetnog-preplitanja-2" class="slide level2">
<h2>Sprečavanje štetnog preplitanja 2</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mutex terminal<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_example<span class="op">(){</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>terminal<span class="op">);</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;ZADAJ VREDNOST BROJA X&quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    cin <span class="op">&gt;&gt;</span> x<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl <span class="op">&lt;&lt;</span> <span class="st">&quot;X = &quot;</span> <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="uslovna-sinhronizacija" class="slide level2">
<h2>Uslovna sinhronizacija</h2>
<ul>
<li>Sinhronizacija kroz <code>mutex</code> je mehanizam koji omogućava da kontrolišemo koliko niti mogu biti u nekoj ključnoj sekciji koda</li>
<li>Ponekad nam ne treba samo to, nego nam je neophodno da neku nit pauziramo dok neki proizvoljan uslov nije zadovoljen.</li>
<li>Nije bitno koji je to uslov, samo da se nit mora pauzirati dok uslov nije ispunjen.</li>
</ul>
</section>
<section id="uslovna-sinhronizacija-1" class="slide level2">
<h2>uslovna sinhronizacija</h2>
<ul>
<li>Klasa koja se koristi da ovo implementira je <code>condition_variable</code></li>
<li>Ako hoćemo da čekamo mi proverimo uslov (i to u while petlji) i u telu petlje pozivemo <code>.wait</code> nad <code>condition_variable</code> instancom.</li>
<li><code>.wait</code> prima lock pod kojim smo trenutno i oslobađa ga dok čekamo da ne bi blokirali ceo program tako što čekamo pod bravom</li>
<li>Ostaćemo u čekanju dok neka druga nit, negde drugde, ne pozove komandu da nas otkoči, to može biti <code>.notify</code> ili <code>.notify_all</code> gde prva otkoči nit koja najduže čeka na uslov, a druga otkoči sve.</li>
</ul>
</section>
<section id="slobodni-baferi---neblokirajuća-verzija" class="slide level2">
<h2>Slobodni baferi - neblokirajuća verzija</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> List_member <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> List <span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    mutex mx<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> first<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    List<span class="op">()</span> <span class="op">:</span> first<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{};</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">);</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlink<span class="op">();</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> List<span class="op">::</span>link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">){</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    member<span class="op">-&gt;</span>next<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    first<span class="op">=</span>member<span class="op">;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="slobodni-baferi---neblokirajuća-verzija-1" class="slide level2">
<h2>Slobodni baferi - neblokirajuća verzija</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>List_member<span class="op">*</span> List<span class="op">::</span>unlink<span class="op">(){</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlinked<span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        unlinked<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>first <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            first<span class="op">=</span>first<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unlinked<span class="op">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="slobodni-baferi---blokirajuća-verzija" class="slide level2">
<h2>Slobodni baferi - blokirajuća verzija</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> List_member <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> next<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> buffer<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> List <span class="op">{</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    mutex mx<span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> first<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    condition_variable nonempty<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    List<span class="op">()</span> <span class="op">:</span> first<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{};</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">);</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlink<span class="op">();</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> List<span class="op">::</span>link<span class="op">(</span>List_member<span class="op">*</span> member<span class="op">){</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    member<span class="op">-&gt;</span>next<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    first<span class="op">=</span>member<span class="op">;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    nonempty<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="slobodni-baferi---blokirajuća-verzija-1" class="slide level2">
<h2>Slobodni baferi - blokirajuća verzija</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>List_member<span class="op">*</span> List<span class="op">::</span>unlink<span class="op">(){</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    List_member<span class="op">*</span> unlinked<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>first <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            nonempty<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        unlinked<span class="op">=</span>first<span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        first<span class="op">=</span>first<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unlinked<span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="komunikacioni-bafer" class="slide level2">
<h2>Komunikacioni bafer</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">int</span> BUFFER_SIZE <span class="op">=</span> <span class="dv">512</span><span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Buffer_states <span class="op">{</span>EMPTY<span class="op">,</span> FULL<span class="op">};</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Buffer <span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    mutex mx</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> content<span class="op">[</span>BUFFER_SIZE<span class="op">];</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    Buffer_states state<span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    condition_variable full<span class="op">;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    condition_variable empty<span class="op">;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    Buffer<span class="op">()</span> <span class="op">{</span>state <span class="op">=</span> EMPTY<span class="op">;};</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">);</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">);</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="komunikacioni-bafer-1" class="slide level2">
<h2>Komunikacioni bafer</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Buffer<span class="op">::</span>put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">){</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>state <span class="op">==</span> FULL<span class="op">)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        empty<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span>   </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> BUFFER_SIZE<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        content<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">*</span>c<span class="op">++;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> FULL<span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    full<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Buffer<span class="op">::</span>get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> c<span class="op">){</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>state <span class="op">==</span> EMPTY<span class="op">)</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        full<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> BUFFER_SIZE<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>c<span class="op">++</span> <span class="op">=</span> content<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    empty<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<ul>
<li>Saradnja niti proizvođača i niti potrošača, u toku koje prva od njih prosleđuje rezultate svoje aktivnosti drugoj niti, može da se prikaže kao razmena poruka.</li>
<li>U toku ove razmene proizvođač odlaže poruku u poseban pregradak iz koga tu poruku preuzima potrošač.</li>
<li>Takvu razmenu poruka podržava templejt klasa <code>Message_box</code></li>
</ul>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke-1" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> MESSAGE<span class="op">&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Message_box <span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    mutex mx<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Message_box_states <span class="op">{</span> EMPTY<span class="op">,</span> FULL <span class="op">};</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    MESSAGE content<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    Message_box_states state<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    condition_variable full<span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    condition_variable empty<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    Message_box<span class="op">()</span> <span class="op">:</span> state<span class="op">(</span>EMPTY<span class="op">)</span> <span class="op">{};</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> send<span class="op">(</span><span class="at">const</span> MESSAGE<span class="op">*</span> message<span class="op">);</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    MESSAGE receive<span class="op">();</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke-2" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> MESSAGE<span class="op">&gt;</span> <span class="dt">void</span> Message_box<span class="op">&lt;</span>MESSAGE<span class="op">&gt;::</span>send<span class="op">(</span><span class="at">const</span> MESSAGE<span class="op">*</span> message<span class="op">){</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>state <span class="op">==</span> FULL<span class="op">)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        empty<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> <span class="op">*</span>message<span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> FULL<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    full<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> MESSAGE<span class="op">&gt;</span> MESSAGE Message_box<span class="op">&lt;</span>MESSAGE<span class="op">&gt;::</span>receive<span class="op">(){</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>state <span class="op">==</span> EMPTY<span class="op">)</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        full<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> EMPTY<span class="op">;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    empty<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> content<span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke-3" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<ul>
<li>Templejt klasa Message_box omogućuje uspostavljanje komunikacionog kanala između niti pošiljaoca i niti primaoca.</li>
<li>Njene operacije <code>send()</code> i <code>receive()</code> omogućuju asinhronu razmenu poruka jer se pošiljalac i primalac ne sreću prilikom razmene poruka (aktivnost pošiljaoca se zaustavlja pri slanju poruka samo kada je komunikacioni kanal pun, dok se aktivnost primaoca zaustavlja pri prijemu poruka samo kada je ovaj kanal prazan).</li>
<li>Ako se kapacitet komunikacionog kanala poveća na dve ili više poruka, tada svakom prijemu mogu da prethode dva ili više slanja.</li>
</ul>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke-4" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<ul>
<li>S druge strane, uz zadržavanje kapaciteta komunikacionog kanala na jednoj poruci, razmena poruka postaje sinhrona, ako se uvek zaustavlja aktivnost niti koja prva započne razmenu poruka.</li>
<li>Aktivnost ove niti ostaje zaustavljena dok i druga nit ne započne razmenu poruka (dok se pošiljalac i primalac ne sretnu).</li>
<li>Pri tome se podrazumeva da pošiljalac nastavlja svoju aktivnost tek kada primalac preuzme poruku.</li>
<li>Prethodno dozvoljava da se u komunikacionom kanalu ne čuva poruka, nego njena adresa.</li>
<li>To doprinosi brzini sinhrone razmene poruka, jer primalac može direktno preuzeti poruku od pošiljaoca.</li>
</ul>
</section>
<section id="komunikacioni-kanal-kapaciteta-jedne-poruke-5" class="slide level2">
<h2>Komunikacioni kanal kapaciteta jedne poruke</h2>
<ul>
<li>Time se izbegava potreba da se poruka prepisuje u komunikacioni kanal, što je neizbežno kod asinhrone razmene poruke.</li>
<li>Iako na ovaj način primalac pristupa lokalnoj promenljivoj pošiljaoca, u kojoj se nalazi poruka, to ne predstavlja problem dok god mehanizam sinhrone razmene poruka osigurava međusobnu isključivost pristupanja pomenutoj lokalnoj promenljivoj.</li>
<li>Pošto sinhrona razmena poruka zahteva da se pošiljalac i primalac poruke sretnu, ona se naziva i randevu (rendezvous).</li>
</ul>
</section></section>
<section>
<section id="pitanja" class="title-slide slide level1">
<h1>Pitanja</h1>

</section>
<section id="pitanja-1" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Šta je preplitanje?</li>
<li>Da li preplitanje ima slučajan karakter?</li>
<li>Šta izaziva pojavu preplitanja?</li>
<li>Da li preplitanje može uticati na rezultat izvršavanja programa?</li>
<li>Šta su deljene promenljive?</li>
<li>Šta je preduslov očuvanja konzistentnosti deljenih promenljivih?</li>
</ul>
</section>
<section id="pitanja-2" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Šta su kritične sekcije?</li>
<li>Šta je sinhronizacija?</li>
<li>Koje vrste sinhronizacije postoje?</li>
<li>Šta je atomski region?</li>
<li>Šta sužava primenu atomskih regiona?</li>
<li>Čemu služi propusnica?</li>
</ul>
</section>
<section id="pitanja-3" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Šta se dešava sa niti koja zatraži, a ne dobije propusnicu?</li>
<li>Šta se dešava kada nit vrati propusnicu?</li>
<li>Kako se štiti konzistentnost propusnica?</li>
<li>Šta je isključivi region?</li>
<li>Šta uvode poželjne osobine konkurentnih programa?</li>
<li>Po čemu se konkurentno programiranje razlikuje od sekvencijalnog?</li>
</ul>
</section>
<section id="pitanja-4" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Koje prednosti ima konkurentna biblioteka u odnosu na konkurentni programski jezik?</li>
<li>Kako se opisuju niti?</li>
<li>Kako se kreiraju niti?</li>
<li>Kada se zauzima propusnica deljene promenljive?</li>
<li>Kada se oslobađa propusnica deljene promenljive?</li>
<li>Kakvu ulogu ima klasa mutex?</li>
</ul>
</section>
<section id="pitanja-5" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Kakvu ulogu ima klasa unique_lock?</li>
<li>Kakvu ulogu ima klasa condition_variable?</li>
<li>Koje vrste razmene poruka postoje?</li>
<li>U čemu se razlikuju sinhrona i asinhrona razmena poruka?</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: false,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [
          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
