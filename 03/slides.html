<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Veljko Petrović">
  <title>Operativni Sistemi - Konkurentno programiranje 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="slides.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Operativni Sistemi - Konkurentno programiranje 2</h1>
  <p class="author">Veljko Petrović</p>
  <p class="date">Mart, 2023</p>
</section>

<section>
<section id="problem-pet-filozofa" class="title-slide slide level1">
<h1>Problem Pet Filozofa</h1>

</section>
<section id="postavka" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Zauzimanje više primeraka resursa iste vrste, neophodnih za aktivnost svake niti iz neke grupe niti, predstavlja tipičan problem konkurentnog programiranja.</li>
<li>On se, u literaturi, ilustruje primerom problema pet filozofa (dining philosophers).</li>
<li>Svaki od njih provodi život razmišljajući u svojoj sobi i jedući u zajedničkoj trpezariji.</li>
<li>U njoj se nalazi pet stolica oko okruglog stola sa pet tanjira i pet viljuški između njih.</li>
</ul>
</section>
<section id="postavka-1" class="slide level2">
<h2>Postavka</h2>
<p><img data-src="img/2023-03-06-18-22-39.png" /></p>
</section>
<section id="postavka-2" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Pošto se, po želji filozofa, u trpezariji služe uvek špagete, svakom filozofu su za jelo potrebne dve viljuške.</li>
<li>Ako svi filozofi istovremeno ogladne, uđu u trpezariju, sednu na svoje mesto za stolom i uzmu viljušku levo od sebe, tada nastupa mrtva petlja (deadlock), s kobnim ishodom po život filozofa.</li>
</ul>
</section>
<section id="normalno-ponašanje" class="slide level2">
<h2>Normalno ponašanje</h2>
<p><img data-src="img/normal.gif" /></p>
</section>
<section id="mrtva-petlja" class="slide level2">
<h2>Mrtva petlja</h2>
<p><img data-src="img/deadlock.gif" /></p>
</section>
<section id="simulator" class="slide level2">
<h2>Simulator</h2>
<ul>
<li>Ponašanje svakog filozofa opisuje funkcija <code>thread_philosopher()</code>.</li>
<li>Razmišljanje filozofa se predstavlja kao odlaganje aktivnosti niti koja reprezentuje filozofa.</li>
<li>Trajanje ovog odlaganja određuje konstanta <code>THINKING_PERIOD</code>.</li>
<li>Na sličan način se predstavlja jedenje filozofa.</li>
<li>Trajanje obroka filozofa određuje konstanta <code>EATING_PERIOD</code>.</li>
</ul>
</section>
<section id="simulator-1" class="slide level2">
<h2>Simulator</h2>
<ul>
<li>Uzimanje viljuške pre jela i njeno vraćanje posle jela, opisuju operacije <code>take_fork()</code> i <code>release_fork()</code> klase <code>Dining_table</code>.</li>
<li>Svaki filozof uzima viljuške jednu po jednu samo ako su one slobodne.</li>
<li>U suprotnom, filozof čeka da svaka viljuška postane raspoloživa.</li>
<li>Prilikom vraćanja viljušaka filozof oslobađa viljuške jednu po jednu i omogući nastavak aktivnosti svojih suseda.</li>
</ul>
</section>
<section id="simulator-2" class="slide level2">
<h2>Simulator</h2>
<ul>
<li>Operacije <code>take_fork()</code> i <code>release_fork()</code> klase <code>Dining_table</code>, dopuštaju pojavu mrtve petlje.</li>
<li>Da bi se ona sigurno desila uvedena su odlaganja aktivnosti niti, koja reprezentuje filozofa, u trajanju koje određuje konstanta <code>MEANTIME</code>.</li>
</ul>
</section>
<section id="simulator-3" class="slide level2">
<h2>Simulator</h2>
<ul>
<li>Polje <code>fork_available</code> deljene klase <code>Dining_table</code> omogućuje očekivanje ispunjenja uslova da je viljuška raspoloživa, kao i objavljivanje ispunjenosti ovog uslova.</li>
<li>Klasa <code>Dining_table</code> sadrži i polja <code>philosopher_state</code> i <code>fork_state</code>.</li>
<li>Prvo od njih izražava stanja filozofa (<code>THINKING</code>, <code>WAITING_LEFT_FORK</code>, <code>HOLDING_ONE_FORK</code>, <code>WAITING_RIGHT_FORK</code>, <code>EATING</code>), a drugo stanja viljuški (<code>FREE</code>, <code>BUSY</code>).</li>
</ul>
</section>
<section id="simulator-4" class="slide level2">
<h2>Simulator</h2>
<ul>
<li>Operacija <code>show()</code> klase <code>Dining_table</code> omogućuje prikazivanje svake promene stanja filozofa.</li>
<li>Za svakog filozofa se u zagradama navode njegova numerička oznaka i njegovo stanje.</li>
<li>Funkcija <code>mod5()</code> podržava modulo aritmetiku.</li>
<li>U funkciji <code>main()</code> se kreiraju niti filozofi, a zatim se sačeka kraj njihove aktivnosti.</li>
<li>Svaka od ovih niti preuzme svoj identitet (<code>Dining_table::take_identity()</code>): 0, 1, 2, 3 i 4 koji omogućuje razlikovanje filozofa.</li>
</ul>
</section>
<section id="simulator-kod" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;thread&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> chrono<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> this_thread<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> mod5<span class="op">(</span><span class="dt">int</span> a<span class="op">)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a <span class="op">&gt;</span> <span class="dv">4</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> a<span class="op">);</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Philosopher_state <span class="op">{</span>THINKING <span class="op">=</span> <span class="ch">&#39;T&#39;</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                    WAITING_LEFT_FORK <span class="op">=</span> <span class="ch">&#39;L&#39;</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                    HOLDING_ONE_FORK <span class="op">=</span> <span class="ch">&#39;O&#39;</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                    WAITING_RIGHT_FORK <span class="op">=</span> <span class="ch">&#39;R&#39;</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                    EATING <span class="op">=</span> <span class="ch">&#39;E&#39;</span><span class="op">};</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Fork_state <span class="op">{</span>FREE<span class="op">,</span> BUSY<span class="op">};</span></span></code></pre></div>
</section>
<section id="simulator-kod-1" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Dining_table <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    mutex mx<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> philosopher_identity<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    Philosopher_state philosopher_state<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    Fork_state fork_state<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    condition_variable fork_available<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> show<span class="op">();</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    Dining_table<span class="op">();</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> take_identity<span class="op">();</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> take_fork<span class="op">(</span><span class="dt">int</span> fork<span class="op">,</span> <span class="dt">int</span> philosopher<span class="op">,</span> Philosopher_state waiting_state<span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            Philosopher_state next_state<span class="op">);</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> release_fork<span class="op">(</span><span class="dt">int</span> fork<span class="op">,</span> <span class="dt">int</span> philosopher<span class="op">,</span> Philosopher_state next_state<span class="op">);</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="simulator-kod-2" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Dining_table<span class="op">::</span>Dining_table<span class="op">(){</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    philosopher_identity<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        philosopher_state<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> THINKING<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        fork_state<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> FREE<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Dining_table<span class="op">::</span>show<span class="op">(){</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="ch">&#39;(&#39;</span> <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dt">char</span><span class="op">)(</span>i<span class="op">+</span><span class="ch">&#39;0&#39;</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;:&#39;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>             <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dt">char</span><span class="op">)</span>philosopher_state<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;) &quot;</span><span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Dining_table<span class="op">::</span>take_identity<span class="op">(){</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> philosopher_identity<span class="op">++;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="simulator-kod-3" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Dining_table<span class="op">::</span>take_fork<span class="op">(</span><span class="dt">int</span> fork<span class="op">,</span> <span class="dt">int</span> philosopher<span class="op">,</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                           Philosopher_state waiting_state<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                           Philosopher_state next_state<span class="op">){</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>fork_state<span class="op">[</span>fork<span class="op">]</span> <span class="op">==</span> BUSY<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        philosopher_state<span class="op">[</span>philosopher<span class="op">]</span> <span class="op">=</span> waiting_state<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span> <span class="op">{</span>fork_available<span class="op">[</span>fork<span class="op">].</span>wait<span class="op">(</span>lock<span class="op">);}</span><span class="cf">while</span><span class="op">(</span>fork_state<span class="op">[</span>fork<span class="op">]</span> <span class="op">==</span> BUSY<span class="op">);</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    fork_state<span class="op">[</span>fork<span class="op">]</span> <span class="op">=</span> BUSY<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    philosopher_state<span class="op">[</span>philosopher<span class="op">]</span> <span class="op">=</span> next_state<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Dining_table<span class="op">::</span>release_fork<span class="op">(</span><span class="dt">int</span> fork<span class="op">,</span> <span class="dt">int</span> philosopher<span class="op">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                Philosopher_state next_state<span class="op">){</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    fork_state<span class="op">[</span>fork<span class="op">]</span> <span class="op">=</span> FREE<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    philosopher_state<span class="op">[</span>philosopher<span class="op">]</span> <span class="op">=</span> next_state<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    fork_available<span class="op">[</span>fork<span class="op">].</span>notify_one<span class="op">();</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="simulator-kod-4" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Dining_table dining_table<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds THINKING_PERIOD<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds MEANTIME<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds EATING_PERIOD<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_philosopher<span class="op">(){</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> philosopher <span class="op">=</span> dining_table<span class="op">.</span>take_identity<span class="op">();</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fork <span class="op">=</span> philosopher<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(;;)</span> <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        sleep_for<span class="op">(</span>THINKING_PERIOD<span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        dining_table<span class="op">.</span>take_fork<span class="op">(</span>fork<span class="op">,</span> philosopher<span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                WAITING_LEFT_FORK<span class="op">,</span> HOLDING_ONE_FORK<span class="op">);</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        sleep_for<span class="op">(</span>MEANTIME<span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        dining_table<span class="op">.</span>take_fork<span class="op">(</span>mod5<span class="op">(</span>fork<span class="op">+</span><span class="dv">1</span><span class="op">),</span> philosopher<span class="op">,</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                WAITING_RIGHT_FORK<span class="op">,</span> EATING<span class="op">);</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        sleep_for<span class="op">(</span>EATING_PERIOD<span class="op">);</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        dining_table<span class="op">.</span>release_fork<span class="op">(</span>fork<span class="op">,</span> philosopher<span class="op">,</span> HOLDING_ONE_FORK<span class="op">);</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        sleep_for<span class="op">(</span>MEANTIME<span class="op">);</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        dining_table<span class="op">.</span>release_fork<span class="op">(</span>mod5<span class="op">(</span>fork<span class="op">+</span><span class="dv">1</span><span class="op">),</span> philosopher<span class="op">,</span> THINKING<span class="op">);</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="simulator-kod-5" class="slide level2">
<h2>Simulator kod</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl <span class="op">&lt;&lt;</span> <span class="st">&quot;DINING PHILOSOPHERS&quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    thread philosopher0<span class="op">(</span>thread_philosopher<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    thread philosopher1<span class="op">(</span>thread_philosopher<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    thread philosopher2<span class="op">(</span>thread_philosopher<span class="op">);</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    thread philosopher3<span class="op">(</span>thread_philosopher<span class="op">);</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    thread philosopher4<span class="op">(</span>thread_philosopher<span class="op">);</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    philosopher0<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    philosopher1<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    philosopher2<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    philosopher3<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    philosopher4<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="rezultat-simulacije" class="slide level2">
<h2>Rezultat simulacije</h2>
<p><img data-src="img/2023-03-07-02-41-51.png" /></p>
</section>
<section id="rešenje" class="slide level2">
<h2>Rešenje?</h2>
<ul>
<li>Postoje mnoga rešenja ovog problema</li>
<li>Najlakši način jeste da se uvede <em>konobar</em> odnosno centralni sinhronizacioni entitet koji služi da se garantuje da se viljuške uzimaju odjednom, odn. ili obe, ili nijedna.</li>
<li>Alternative jeste da se razbije cikličnost tako što se primeti da imamo simetriju: uvek uzimamo levu pa desnu. Šta ako makar jedan filozof uvek prvo uzme prvo desnu pa levu ili parni filozofi uzimeju uvek levu pa desnu?</li>
</ul>
</section>
<section id="rešenje-1" class="slide level2">
<h2>Rešenje</h2>
<ul>
<li>Još jedan problem koji rešava problem stohastički za relativno retke petlje jeste onaj koji se koristi u određenim verzijama Etherneta</li>
<li>Umesto da čekamo zauvek (<code>.wait</code>) koristimo čekanje sa <code>wait_for</code> ili <code>wait_until</code> što omogućava da se čeka do ispunjenja uslova <em>ili</em> dok ne istakne neko vreme.</li>
<li>Naravno ako čekamo svi isto vreme možemo da upadnemo u petlju gde se svi ‘sudarimo’ i onda čekamo neko (isto) vreme, pa se opet ‘sudarimo’ i tako u beskonačnost</li>
<li>To se zove i ‘živa’ petlja odn. ‘livelock’</li>
</ul>
</section>
<section id="rešenje-2" class="slide level2">
<h2>Rešenje</h2>
<ul>
<li>Umesto da čekamo uvek isto vreme, mi oslobodimo ono što smo zauzeli, čekamo nasumično vreme, i probamo opet</li>
<li>Ovo razbije simetriju i omogući da se sistem eventualno odglavi</li>
</ul>
</section></section>
<section>
<section id="mrtva-petlja-1" class="title-slide slide level1">
<h1>Mrtva petlja</h1>

</section>
<section id="pet-filozofa-i-mrtve-petlje" class="slide level2">
<h2>Pet filozofa i mrtve petlje</h2>
<ul>
<li>Pet filozofa je namerno upečatljiv primer mrtve petlje, ali ona može da nastane na raznim mestima</li>
<li>Svaki višenitni program je ranjiv</li>
<li>Takođe svaki operativni sistem koji zaključava fajlove za pristup</li>
<li>Ako se steknu uslovi, onda gdegod da imamo zaključavanje i višestruko izvršavanje, mrtva petlja je moguća</li>
</ul>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<ul>
<li>Mrtva petlja je problematična pojava trajnog zaustavljanja aktivnosti međusobno zavisnih procesa.</li>
<li>Na primer, ona se javi kada dva procesa žele da u režimu međusobne isključivosti pristupaju dvema datotekama.</li>
<li>Ako prvi od njih zaključa prvu datoteku, a zatim drugi od njih zaključa drugu datoteku, tada nema mogućnosti za nastavak aktivnosti tih procesa, bez obzira da li je sistemska operacija zaključavanja blokirajuća ili ne.</li>
</ul>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje-1" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<ul>
<li>U slučaju blokirajućih sistemskih operacija zaključavanja, pokušaj prvog procesa da zaključa drugu datoteku dovodi do trajnog zaustavljanja njegove aktivnosti.</li>
<li>Isto se dešava sa drugim procesom prilikom njegovog pokušaja da zaključa prvu datoteku.</li>
<li>Zaustavljanje aktivnosti ova dva procesa je trajno, jer je svaki od njih zauzeo datoteku koja treba onom drugom procesu za nastavak njegove aktivnosti i nema nameru da tu datoteku oslobodi.</li>
</ul>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje-2" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<p><img data-src="img/2023-03-07-02-55-31.png" /></p>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje-3" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<ul>
<li>U slučaju neblokirajuće sistemske operacije zaključavanja, procesi upadaju u beskonačnu petlju (starvation), pokušavajući da zaključaju datoteku, koju je zaključao drugi proces.</li>
<li>Ovakav oblik međusobne zavisnosti procesa se naziva i živa petlja (livelock).</li>
<li>Ona se, po svom ishodu, suštinski ne razlikuje od mrtve petlje.</li>
</ul>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje-4" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<ul>
<li>Pojava mrtve petlje je vezana za zauzimanje resursa, kao što su, na primer, prethodno pomenute datoteke.</li>
<li>Pri tome, za pojavu mrtve petlje je potrebno da budu ispunjena četiri uslova.</li>
</ul>
</section>
<section id="uslovi-za-pojavu-mrtve-petlje-5" class="slide level2">
<h2>Uslovi za pojavu mrtve petlje</h2>
<ol type="1">
<li>zauzimani resursi se koriste u režimu međusobne isključivosti</li>
<li>resursi se zauzimaju jedan za drugim, tako da proces, nakon zauzimanja izvesnog broja resursa, mora da čeka da zauzme preostale resurse</li>
<li>resurse oslobađaju samo procesi koji su ih zauzeli</li>
<li>postoji cirkularna međuzavisnost procesa (prvi proces čeka oslobađanje resursa koga drži drugi proces, a on čeka oslobađanje resursa koga drži treći proces, i tako redom do poslednjeg procesa iz lanca procesa, koji čeka oslobađanje resursa koga drži prvi proces).</li>
</ol>
</section>
<section id="tretiranje-mrtve-petlje" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Postoje četiri pristupa tretiranja problema mrtve petlje:</li>
<li>sprečavanje (prevention) pojave mrtve petlje (onemogućavanjem važenja nekog od četiri neophodna uslova za njenu pojavu)</li>
<li>izbegavanje (avoidance) pojave mrtve petlje</li>
<li>otkrivanje (detection) pojave mrtve petlje i oporavak (recovery) od nje</li>
<li>ignorisanje pojave mrtve petlje.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-1" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Kod sprečavanja pojave mrtve petlje, važenje prvog uslova obično nije moguće sprečiti, jer se resursi najčešće koriste u režimu međusobne isključivosti.</li>
<li>Važenje drugog uslova se može sprečiti, ako se unapred zna koliko treba resursa i ako se oni svi zauzmu pre korišćenja.</li>
<li>Pri tome, neuspeh u zauzimanju bilo kog resursa dovodi do oslobađanja prethodno zauzetih resursa, što je moguće učiniti bez posledica, jer nije započelo njihovo korišćenje.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-2" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Važenje trećeg uslova se obično ne može sprečiti, jer najčešće ne postoji način da se zauzeti resurs privremeno oduzme procesu.</li>
<li>I konačno, važenje četvrtog uslova se može sprečiti, ako se resursi uvek zauzimaju u unapred određenom redosledu, koji isključuje mogućnost cirkularne međuzavisnosti procesa (primer pozitivnog rešenja 5 filozofa).</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-3" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Izbegavanje pojave mrtve petlje zahteva poznavanje podataka:
<ul>
<li>o maksimalno mogućim zahtevima za resursima</li>
<li>ukupno postavljenim zahtevima za resursima</li>
<li>stanju resursa</li>
</ul></li>
<li>Podrazumeva se da se udovoljava samo onim zahtevima za koje se proverom ustanovi da, nakon njihovog ispunjavanja, postoji redosled zauzimanja i oslobađanja resursa u kome se mogu zadovoljiti maksimalno mogući zahtevi svih procesa.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-4" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Praktična vrednost ovoga pristupa nije velika, jer se obično unapred ne znaju maksimalno mogući zathevi procesa za resursima, a to je neophodno za proveru da li se može udovoljiti pojedinim zahtevima.</li>
<li>Sem toga, ovakva provera je komplikovana, a to znači i neefikasna.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-5" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Otkrivanje pojave mrtve petlje se zasniva na sličnom pristupu kao i izbegavanje pojave mrtve petlje.</li>
<li>U ovom slučaju se proverava da li postoji proces, čijim zahtevima se ne može udovoljiti ni za jedan redosled zauzimanja i oslobađanja resursa.</li>
<li>Pored komplikovanosti ovakve provere, problem je i šta učiniti, kada se i otkrije pojava mrtve petlje.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-6" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Ako se resursi ne mogu privremeno oduzeti od procesa, preostaje jedino uništavanje procesa, radi oslobađanja resursa koje oni drže.</li>
<li>Međutim, to nije uvek prihvatljiv zahvat.</li>
<li>Zbog toga ni ovaj pristup nema veliki praktični značaj.</li>
</ul>
</section>
<section id="tretiranje-mrtve-petlje-7" class="slide level2">
<h2>Tretiranje mrtve petlje</h2>
<ul>
<li>Ignorisanje pojave mrtve petlje je pristup koji je najčešće primenjen u praksi, jer se ovaj problem ne javlja tako često da bi se isplatilo da ga rešava operativni sistem.</li>
<li>Prema tome, kada se mrtva petlja javi, na korisniku je da se suoči sa ovim problemom i da ga reši na način, koji je primeren datim okolnostima.</li>
</ul>
</section></section>
<section>
<section id="problem-čitanja-i-pisanja" class="title-slide slide level1">
<h1>Problem čitanja i pisanja</h1>

</section>
<section id="postavka-3" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Problem čitanja i pisanja (readers-writers problem) se može objasniti na primeru kao što je rukovanje bankovnim računima.</li>
<li>Bankovni računi pripadaju komitentima banke i sadrže ukupan iznos novčanih sredstava svakog od komitenata.</li>
<li>U najjednostavnijem slučaju, rukovanje bankovnim računima se svodi: na prenos sredstava (s jednog računa na drugi) i na proveru (stanja svih) računa.</li>
</ul>
</section>
<section id="postavka-4" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Prenos sredstava obuhvata četiri koraka:
<ul>
<li>Čitanje stanja računa s koga se prenose sredstva</li>
<li>Pisanje novog stanja na ovaj račun. Novo stanje se dobije umanjivanjem pročitanog stanja za prenošeni iznos</li>
<li>Čitanje stanja računa na koji se prenose sredstva.</li>
<li>Pisanje novog stanja na račun na koji se prenose sredstva. Novo stanje se dobije uvećavanjem pročitanog stanja za prenošeni iznos</li>
</ul></li>
</ul>
</section>
<section id="postavka-5" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Uz pretpostavku da su prenosi sredstava mogući samo između posmatranih bankovnih računa, ukupna suma njihovih stanja je nepromenljiva.</li>
<li>Prema tome, provera računa se svodi na čitanja, jedno za drugim, stanja svih računa, radi njihovog sumiranja.</li>
<li>Ispravnost prenosa sredstava zavisi od očuvanja konzistentnosti stanja svih računa, za šta je neophodna međusobna isključivost raznih prenosa sredstava. U suprotnom, moguće su razne greške.</li>
</ul>
</section>
<section id="postavka-6" class="slide level2">
<h2>Postavka</h2>
<ul>
<li>Iz prethodne analize sledi:
<ul>
<li>Da je za ispravnost prenosa bitno da prenosi budu međusobno isključivi.</li>
<li>Da je za ispravnost provera bitno da provere i prenosi budu međusobno isključivi.</li>
</ul></li>
<li>Pošto prenosi sadrže pisanja, a provere samo čitanja, sledi da operacije sa pisanjem moraju biti međusobno isključive, kao što moraju biti međusobno isključive operacije sa pisanjem i operacije sa čitanjem.</li>
<li>Za operacije koje sadrže samo čitanja međusobna isključivost nije potrebna.</li>
</ul>
</section>
<section id="kod" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;thread&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> chrono<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> this_thread<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">unsigned</span> ACCOUNTS_NUMBER <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> INITIAL_AMOUNT <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Bank <span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    mutex mx<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> accounts<span class="op">[</span>ACCOUNTS_NUMBER<span class="op">];</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> readers_number<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> writers_number<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> readers_delayed_number<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> writers_delayed_number<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    condition_variable readers_q<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    condition_variable writers_q<span class="op">;</span></span></code></pre></div>
</section>
<section id="kod-1" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> show<span class="op">();</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> reader_begin<span class="op">();</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> reader_end<span class="op">();</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> writer_begin<span class="op">();</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> writer_end<span class="op">();</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    Bank<span class="op">();</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> audit<span class="op">();</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> transaction<span class="op">(</span><span class="dt">unsigned</span> source<span class="op">,</span> <span class="dt">unsigned</span> destination<span class="op">);</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>Bank<span class="op">::</span>Bank<span class="op">(){</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ACCOUNTS_NUMBER<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        accounts<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> INITIAL_AMOUNT<span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    readers_number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    writers_number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    readers_delayed_number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    writers_delayed_number <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-2" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>show<span class="op">(){</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;RN: &quot;</span> <span class="op">&lt;&lt;</span> readers_number <span class="op">&lt;&lt;</span> <span class="st">&quot; RDN: &quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="op">&lt;&lt;</span> readers_delayed_number <span class="op">&lt;&lt;</span> <span class="st">&quot; WN: &quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="op">&lt;&lt;</span> writers_number <span class="op">&lt;&lt;</span> <span class="st">&quot; WDN: &quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="op">&lt;&lt;</span> writers_delayed_number <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>reader_begin<span class="op">(){</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">((</span>writers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>writers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        readers_delayed_number<span class="op">++;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span> <span class="op">{</span> readers_q<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span> <span class="op">}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">((</span>writers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>              <span class="op">(</span>writers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-3" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    readers_number<span class="op">++;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>readers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        readers_delayed_number<span class="op">--;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        readers_q<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>reader_end<span class="op">(){</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    readers_number<span class="op">--;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">((</span>readers_number <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>writers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)){</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        writers_delayed_number<span class="op">--;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        writers_q<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-4" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>writer_begin<span class="op">(){</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">((</span>readers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>writers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)){</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        writers_delayed_number<span class="op">++;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span> <span class="op">{</span> writers_q<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span> <span class="op">}</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">((</span>readers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>writers_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    writers_number<span class="op">++;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-5" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>writer_end<span class="op">(){</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    writers_number<span class="op">--;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    show<span class="op">();</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>writers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        writers_delayed_number<span class="op">--;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        writers_q<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>readers_delayed_number <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        readers_delayed_number<span class="op">--;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        show<span class="op">();</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        readers_q<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-6" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds WRITING_PERIOD<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>transaction<span class="op">(</span><span class="dt">unsigned</span> source<span class="op">,</span><span class="dt">unsigned</span> destination<span class="op">){</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> amount<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    writer_begin<span class="op">();</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    sleep_for<span class="op">(</span>WRITING_PERIOD<span class="op">);</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    amount <span class="op">=</span> accounts<span class="op">[</span>source<span class="op">];</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">[</span>source<span class="op">]</span> <span class="op">-=</span> amount<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">[</span>destination<span class="op">]</span> <span class="op">+=</span> amount<span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    writer_end<span class="op">();</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>Bank bank<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_reader<span class="op">(){</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    bank<span class="op">.</span>audit<span class="op">();</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-7" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds READING_PERIOD<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>audit<span class="op">(){</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    reader_begin<span class="op">();</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    sleep_for<span class="op">(</span>READING_PERIOD<span class="op">);</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ACCOUNTS_NUMBER<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> accounts<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    reader_end<span class="op">();</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sum <span class="op">!=</span> ACCOUNTS_NUMBER<span class="op">*</span>INITIAL_AMOUNT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">&quot; audit error &quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-8" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> milliseconds WRITING_PERIOD<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Bank<span class="op">::</span>transaction<span class="op">(</span><span class="dt">unsigned</span> source<span class="op">,</span><span class="dt">unsigned</span> destination<span class="op">){</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> amount<span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    writer_begin<span class="op">();</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    sleep_for<span class="op">(</span>WRITING_PERIOD<span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    amount <span class="op">=</span> accounts<span class="op">[</span>source<span class="op">];</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">[</span>source<span class="op">]</span> <span class="op">-=</span> amount<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">[</span>destination<span class="op">]</span> <span class="op">+=</span> amount<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    writer_end<span class="op">();</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>Bank bank<span class="op">;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_reader<span class="op">(){</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    bank<span class="op">.</span>audit<span class="op">();</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="kod-9" class="slide level2">
<h2>Kod</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_writer0to1<span class="op">(){</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    bank<span class="op">.</span>transaction<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> thread_writer1to0<span class="op">(){</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    bank<span class="op">.</span>transaction<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> endl <span class="op">&lt;&lt;</span> <span class="st">&quot;READERS AND WRITERS&quot;</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    thread reader0<span class="op">(</span>thread_reader<span class="op">);</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    thread reader1<span class="op">(</span>thread_reader<span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    thread writer0<span class="op">(</span>thread_writer0to1<span class="op">);</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    thread reader2<span class="op">(</span>thread_reader<span class="op">);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    thread writer1<span class="op">(</span>thread_writer1to0<span class="op">);</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    reader0<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    reader1<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    writer0<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    reader2<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    writer1<span class="op">.</span>join<span class="op">();</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="komentar-o-rešenju" class="slide level2">
<h2>Komentar o rešenju</h2>
<ul>
<li>Ovo rešenje, eksplicitno, je napravljeno tako da pisanje ima prednost u odnosu na čitanje</li>
<li>Ako je plan da bude obrnuto onda su potrebne promene</li>
</ul>
</section></section>
<section>
<section id="rizici-konkurentnog-programiranja" class="title-slide slide level1">
<h1>Rizici konkurentnog programiranja</h1>

</section>
<section id="rizici" class="slide level2">
<h2>Rizici</h2>
<ul>
<li>Opisivanje obrada podataka je jedini cilj sekvencijalnog, a osnovni cilj konkurentnog programiranja.</li>
<li>Bolje iskorišćenje računara i njegovo čvršće sprezanje sa okolinom su dodatni ciljevi konkurentnog programiranja, po kojima se ono i razlikuje od sekvencijalnog programiranja.</li>
<li>Od suštinske važnosti je da ostvarenje dodatnih ciljeva ne ugrozi ostvarenje osnovnog cilja, jer je on neprikosnoven, pošto je konkurentni program upotrebljiv jedino ako iza svakog od njegovih izvršavanja ostaju samo ispravno obrađeni podaci.</li>
</ul>
</section>
<section id="rizici-1" class="slide level2">
<h2>Rizici</h2>
<ul>
<li>Tipične poželjne osobine sekvencijalnog, a to znači i konkurentnog programa obuhvataju tvrdnje uključivanja poželjnog, kao što je tvrdnja da nakon izvršavanja programa ostaju ispravno obrađeni podaci, i tvrdnje isključivanja nepoželjnog, kao što je tvrdnja da program ne sadrži beskonačne petlje.</li>
<li>Tipične dodatne poželjne osobine konkurentnog programa obuhvataju tvrdnje uključivanja poželjnog, kao što je tvrdnja da su, u toku izvršavanja programa, deljene promenljive stalno konzistentne, i tvrdnje isključivanja nepoželjnog, kao što je tvrdnja da u toku izvršavanja programa ne dolazi do trajnog zaustavljanja aktivnosti niti.</li>
</ul>
</section>
<section id="rizici-2" class="slide level2">
<h2>Rizici</h2>
<ul>
<li>Ispravnu obradu podataka ugrožava narušavanje konzistentnosti deljenih promenljivih u toku izvršavanja konkurentnog programa.</li>
<li>Do narušavanja konzistentnosti deljenih promenljivih dolazi, ako na kraju isključivog regiona deljena promenljiva nije u konzistentnom stanju ili ako se operacija wait() pozove pre nego je deljena promenljiva dovedena u konzistentno stanje</li>
</ul>
</section>
<section id="pozivanje-wait-pre-dovođenja-u-konzistentno-stanje" class="slide level2">
<h2>Pozivanje <code>wait</code> pre dovođenja u konzistentno stanje</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&lt; exclusive region 1 &gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    some_condition<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&lt; exclusive region 2 &gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="mrtva-petlja-među-nitima" class="slide level2">
<h2>Mrtva petlja među nitima</h2>
<ul>
<li>Upotrebljivost konkurentnih programa ugrožava i pojava međuzavisnosti niti, poznata pod nazivom mrtva petlja.</li>
<li>Ona dovodi do trajnog zaustavljanja aktivnosti niti, a to ima za posledicu da izvršavanje konkurentnog programa nema kraja.</li>
<li>Konkurentni program, u toku čijeg izvršavanja je moguća pojava mrtve petlje, nije upotrebljiv, jer pojedina od njegovih izvršavanja, koja nemaju kraja, ne dovode do uspešne obrade podataka.</li>
<li>Do mrtve petlje može da dođe, na primer, ako se iz jedne deljene klase pozivaju operacije druge deljene klase, pod uslovom da je bar jedna od pozivanih operacija blokirajuća.</li>
</ul>
</section>
<section id="minimalni-primer-mrtve-petlje" class="slide level2">
<h2>Minimalni primer mrtve petlje</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Activity <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    mutex mx_activity<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    condition_variable activity_permission<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> stop<span class="op">();</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> start<span class="op">();</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Activity<span class="op">::</span>stop<span class="op">(){</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx_activity<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    activity_permission<span class="op">.</span>wait<span class="op">(</span>lock<span class="op">);</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Activity<span class="op">::</span>start<span class="op">(){</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx_activity<span class="op">);</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    activity_permission<span class="op">.</span>notify_one<span class="op">();</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="minimalni-primer-mrtve-petlje-1" class="slide level2">
<h2>Minimalni primer mrtve petlje</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Manager <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    mutex mx_manager<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    Activity activity<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> disable_activity<span class="op">();</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enable_activity<span class="op">();</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Manager<span class="op">::</span>disable_activity<span class="op">(){</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx_manager<span class="op">);</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    activity<span class="op">.</span>stop<span class="op">();</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Manager<span class="op">::</span>enable_activity<span class="op">(){</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx_manager<span class="op">);</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    activity<span class="op">.</span>start<span class="op">();</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>Manager manager<span class="op">;</span></span></code></pre></div>
</section>
<section id="minimalna-mrtva-petlja" class="slide level2">
<h2>Minimalna mrtva petlja</h2>
<ul>
<li>Mrtve petlje, koje ilustruje prethodni primer, se mogu sprečiti, ako se blokirajuća operacija ne poziva iz isključivog regiona.</li>
<li>Nenamerno izazivanje konačnog, ali nepredvidivo dugog zaustavljanja aktivnosti niti u toku isključivog regiona može da ima negativne posledice na izvršavanje programa.</li>
<li>To se, na primer, desi, kada se iz isključivog regiona pozivaju potencijalno blokirajuće operacije, poput funkcije <code>sleep_for()</code>.</li>
<li>Globalne const promenljive, koje služe za smeštanje podataka, raspoloživih svim nitima, ne spadaju u deljene promenljive.</li>
</ul>
</section></section>
<section>
<section id="pitanja" class="title-slide slide level1">
<h1>Pitanja</h1>

</section>
<section id="pitanja-1" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Opisati problem pet filozofa.</li>
<li>Kako bi izgledala verzija problema pet filozofa koja bi se realistično mogla sresti tokom razvoja softvera?</li>
<li>Šta je mrtva petlja?</li>
<li>Po čemu se živa petlja razlikuje od mrtve petlje?207. Koji uslovi su potrebni za pojavu mrtve petlje?</li>
<li>Kako se u praksi tretira problem mrtve petlje?</li>
<li>Na čemu se temelji sprečavanje mrtve petlje?</li>
</ul>
</section>
<section id="pitanja-2" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Šta karakteriše izbegavanje mrtve petlje?</li>
<li>Šta karakteriše otkrivanje i oporavak od mrtve petlje?</li>
<li>Šta karakteriše ignorisanje mrtve petlje?</li>
<li>Opisati problem čitanja i pisanja.</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: false,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [
          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
