<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Veljko Petrović">
  <title>Operativni Sistemi - Simulator operativnog sistema 1</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/night.css" id="theme">
  <link rel="stylesheet" href="slides.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Operativni Sistemi - Simulator operativnog sistema
1</h1>
  <p class="author">Veljko Petrović</p>
  <p class="date">Mart, 2024</p>
</section>

<section>
<section id="uvod" class="title-slide slide level1">
<h1>Uvod</h1>

</section>
<section id="šta-simuliramo" class="slide level2">
<h2>Šta simuliramo</h2>
<ul>
<li>Ovo je simulator operativnog sistema koji radi pod određenim znatnim
ograničenjima</li>
<li>Simulira (isključivo) jednoprocesorni operativni sistem i to kroz
konkurentnu biblioteku</li>
<li>Šta znači da simulira kroz konkurentnu biblioteku? Da je interfejs
prema ovome onaj isti C++ interfejs ka nitima, sa tom razlikom da umesto
da koristimo POSIX niti, mi sami realizujemo prebacivanje između niti i
to u obliku simulatora operativnog sistema.</li>
<li>Radi (isključivo) na 32-bitnoj x86 arhitekturi koju ste koristili
prošli semestar.</li>
</ul>
</section>
<section id="šta-simuliramo-1" class="slide level2">
<h2>Šta simuliramo</h2>
<ul>
<li>Ništa od ovih stvari nisu 100% aktuelne, ali su odličan smanjeni
skup funkcionalnosti koji nam može pomoći da razumemo osnovne
principe.</li>
<li>Gde je prigodno tokom kursa, mi skačemo u kod Linux kernela da
vidimo apsolutno aktuelnu i ozbiljnu verziju ovoga</li>
<li>Termin koji povremeno koristimo za simulator je i CppTss pošto
implementiramo podskup za niti iz ranog 2011 standarda za C++ zato što
je relativno jednostavan za razumevanje.</li>
</ul>
</section>
<section id="šta-ne-simuliramo" class="slide level2">
<h2>Šta ne simuliramo</h2>
<ul>
<li>Ništa od ovoga nije pravi operativni sistem u klasičnom smislu</li>
<li>Ako vas zanima kako se operativni sistem startuje od nule na pravom
hardveru: sačekajte. Pričaćemo i o tome.</li>
<li>Za sada nas zanima da povežemo gradivo ovde sa gradivom iz AR na
nečemu što je dovoljno pojednostavjeno da celo može da stane na
predavanja.</li>
</ul>
</section></section>
<section>
<section id="osnove-simulatora" class="title-slide slide level1">
<h1>Osnove simulatora</h1>

</section>
<section id="atomski-regioni" class="slide level2">
<h2>Atomski regioni</h2>
<ul>
<li>Stvaranje atomskih regiona omogućuje klasa
<code>Atomic_region</code>.</li>
<li>Njen konstruktor onemogućuje prekide, a destruktor vraća prekide u
stanje koje je prethodilo akciji konstruktora.</li>
</ul>
</section>
<section id="atomski-regioni-1" class="slide level2">
<h2>Atomski regioni</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//kod</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="atomski-regioni-2" class="slide level2">
<h2>Atomski regioni</h2>
<ul>
<li>Upotrebu atomskog regiona ilustruje primer rukovanja pozicijom
kursora u kome nisu moguća štetna preplitanja niti i obrada prekida, jer
telo operacije <code>get()</code> klase <code>Position</code> obrazuje
atomski region.</li>
<li>Pošto se operacija <code>set()</code> poziva samo iz obrada prekida,
njeno telo po definiciji obrazuje atomski region (jer su prekidi
onemogućeni u toku obrade prekida, barem kod nas), pa je tako osigurana
međusobna isključivost operacija klase <code>Position.</code></li>
</ul>
</section>
<section id="primer-sa-kursorom" class="slide level2">
<h2>Primer sa kursorom</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">class</span> Position <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    Position<span class="op">();</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="dt">void</span> set<span class="op">(</span><span class="dt">int</span> new_x<span class="op">,</span> <span class="dt">int</span> new_y<span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="dt">void</span> get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> current_x<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> current_y<span class="op">);</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="primer-sa-kursorom-1" class="slide level2">
<h2>Primer sa kursorom</h2>
<div class="sourceCode" id="cb3" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb3-8"><a href="#cb3-8"></a>Position<span class="op">::</span>Position<span class="op">(){</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>    x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>    y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="op">}</span></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="dt">void</span> Position<span class="op">::</span>set<span class="op">(</span><span class="dt">int</span> new_x<span class="op">,</span> <span class="dt">int</span> new_y<span class="op">){</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="co">//ne mora atomski ako su prekidi prekida zabranjeni</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>    x <span class="op">=</span> new_x<span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>    y <span class="op">=</span> new_y<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="primer-sa-kursorom-2" class="slide level2">
<h2>Primer sa kursorom</h2>
<div class="sourceCode" id="cb4" data-startFrom="18"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 17;"><span id="cb4-18"><a href="#cb4-18"></a><span class="dt">void</span> Position<span class="op">::</span>get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> current_x<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> current_y<span class="op">){</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>    <span class="op">*</span>current_x <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="op">*</span>current_y <span class="op">=</span> y<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-driver" class="slide level2">
<h2>Klasa <code>Driver</code></h2>
<ul>
<li>Pisanje drajvera olakšava klasa <code>Driver.</code></li>
<li>Nju nasleđuju klase koje opisuju ponašanje drajvera.</li>
<li>Drajvere karakteriše saradnja obrađivača prekida i pozadinskih
niti.</li>
<li>U okviru klase, koja opisuje ponašanje drajvera, obrađivač prekida
se predstavlja u obliku funkcije bez povratne vrednosti i bez
parametara.</li>
<li>Ova funkcija mora biti <code>static,</code> da bi se mogla koristiti
njena adresa.</li>
<li>Takva moraju biti i sva polja klase kojima ona pristupa.</li>
</ul>
</section>
<section id="klasa-driver-1" class="slide level2">
<h2>Klasa <code>Driver</code></h2>
<ul>
<li>Operacija <code>start_interrupt_handling()</code> klase
<code>Driver</code> omogućuje smeštanje adrese obrađivača prekida u
tabelu prekida.</li>
<li>Prvi argument poziva ove operacije predstavlja broj vektora prekida,
a drugi adresu obrađivača prekida.</li>
<li>Saradnja obrađivača prekida i pozadinskih niti podrazumeva da
pozadinske niti čekaju dešavanje spoljnih događaja, a da obrađivači
prekida objavljuju dešavanje spoljnih događaja.</li>
</ul>
</section>
<section id="neki-primeri-iz-stvarne-prakse-linux" class="slide level2">
<h2>Neki primeri iz stvarne prakse – Linux</h2>
<p><img data-src="img/2023-03-21-01-40-41.png" /></p>
</section>
<section id="neki-primeri-iz-stvarne-prakse-linux-1"
class="slide level2">
<h2>Neki primeri iz stvarne prakse – Linux</h2>
<p><img data-src="img/2023-03-21-01-41-02.png" /></p>
</section>
<section id="neki-primeri-iz-stvarne-prakse-linux-2"
class="slide level2">
<h2>Neki primeri iz stvarne prakse – Linux</h2>
<p><img data-src="img/2023-03-21-01-41-11.png" /></p>
</section>
<section id="event-i-driver" class="slide level2">
<h2><code>Event</code> i <code>Driver</code></h2>
<ul>
<li>Klasa <code>Driver</code> ima kao povezanu klasu
<code>Event</code></li>
<li><code>signal</code> metoda
<ul>
<li>Poziva se iz atomskog regiona</li>
<li>Nit prelazi u čekanje</li>
<li>Preključivanje na spremnu nit</li>
</ul></li>
<li><code>expect</code> metoda
<ul>
<li>Poziva se iz obrađivača prekida</li>
<li>Nit koja čeka najduže prelazi u stanje spremna</li>
<li>Poziva se na kraju obrade prekida samo jednom</li>
</ul></li>
</ul>
</section>
<section id="drajver-za-rukovanje-vremenom" class="slide level2">
<h2>Drajver za rukovanje vremenom</h2>
<ul>
<li>Ovaj drajver registruje proticanje vremena u računaru brojanjem
otkucaja sata.</li>
<li>Otkucaji, čiji period zavisi od takta procesora, nisu uvek podesni
za određivanje vremena u danu, predstavljenog brojem sati, minuta i
sekundi, jer sekunda ne može uvek da se izrazi celim brojem perioda
ovakvih otkucaja.</li>
<li>Zato je zgodno uvesti dodatni sat, čiji otkucaji (prekidi) imaju
period od tačno jedne sekunde.</li>
<li>Ova komponenta se, tradicionalno, zove ’Real Time Clock’ u
računarima i vi je imate na matičnoj ploči, tipično zakčenoj za SRAM
modul i CR2032 bateriju.</li>
</ul>
</section>
<section id="drajver-za-rukovanje-vremenom-1" class="slide level2">
<h2>Drajver za rukovanje vremenom</h2>
<ul>
<li>Rukovanje ovim satom, odnosno rukovanje vremenom opisuje klasa
<code>Timer_driver</code>.</li>
<li>Njena tri celobrojna polja: <code>hour</code>, <code>minute</code> i
<code>second</code> sadrže broj proteklih sati, minuta i sekundi.</li>
<li>Početni sadržaj ovih polja određuje konstruktor klase
<code>Timer_driver</code>.</li>
</ul>
</section>
<section id="drajver-za-rukovanje-vremenom-2" class="slide level2">
<h2>Drajver za rukovanje vremenom</h2>
<ul>
<li>Pored toga on u element tabele prekida, koga indeksira konstanta
<code>TIMER</code> (broj vektora prekida dodatnog sata), smesti adresu
njene operacije <code>interrupt_handler()</code>, koja je zadužena za
periodičnu izmenu sadržaja polja <code>hour</code>, <code>minute</code>
i <code>second</code>, sa periodom od jedne sekunde.</li>
</ul>
</section>
<section id="drajver-za-rukovanje-vremenom-3" class="slide level2">
<h2>Drajver za rukovanje vremenom</h2>
<ul>
<li>Klasa <code>Timer_driver</code> sadrži i operacije
<code>set()</code> i <code>get()</code> za zadavanje i preuzimanje
sadržaja njenih polja.</li>
<li>To su osetljive operacije, čije preplitanje sa obradom prekida sata
je štetno.</li>
<li>Na primer, ako se obrada prekida sata desi nakon preuzimanja
sadržaja polja hour, a pre preuzimanja sadržaja polja minute, i ako je,
uz to, broj minuta pre periodične izmene bio na granici od 59, tada
preuzeto vreme kasni iza stvarnog za 60 minuta.</li>
<li>Da bi se ovakva štetna preplitanja sprečila, preuzimanja i zadavanja
sadržaja njenih polja moraju da budu u atomskim regionima.</li>
</ul>
</section>
<section id="klasa-timer_driver" class="slide level2">
<h2>Klasa <code>Timer_driver</code></h2>
<div class="sourceCode" id="cb5"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">class</span> Timer_driver <span class="op">:</span> <span class="kw">public</span> Driver <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="at">static</span> <span class="dt">int</span> hour<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="at">static</span> <span class="dt">int</span> minute<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="at">static</span> <span class="dt">int</span> second<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="at">static</span> <span class="dt">void</span> interrupt_handler<span class="op">();</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    Timer_driver<span class="op">()</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="op">{</span> start_interrupt_handling<span class="op">(</span>TIMER<span class="op">,</span>   </span>
<span id="cb5-9"><a href="#cb5-9"></a>      interrupt_handler<span class="op">);</span> <span class="op">};</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="dt">void</span> set<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> h<span class="op">,</span> <span class="at">const</span> <span class="dt">int</span> m<span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>                <span class="at">const</span> <span class="dt">int</span> s<span class="op">);</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="dt">void</span> get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> h<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> m<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> s<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="klasa-timer_driver-1" class="slide level2">
<h2>Klasa <code>Timer_driver</code></h2>
<div class="sourceCode" id="cb6" data-startFrom="14"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 13;"><span id="cb6-14"><a href="#cb6-14"></a><span class="dt">int</span> Timer_driver<span class="op">::</span>hour <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="dt">int</span> Timer_driver<span class="op">::</span>minute <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="dt">int</span> Timer_driver<span class="op">::</span>second <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-timer_driver-2" class="slide level2">
<h2>Klasa <code>Timer_driver</code></h2>
<div class="sourceCode" id="cb7" data-startFrom="17"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 16;"><span id="cb7-17"><a href="#cb7-17"></a><span class="dt">void</span> Timer_driver<span class="op">::</span>interrupt_handler<span class="op">()</span> <span class="op">{</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>    <span class="cf">if</span><span class="op">(</span>second <span class="op">&lt;</span> <span class="dv">59</span><span class="op">)</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>        second<span class="op">++;</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>    <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>        second <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>        <span class="cf">if</span><span class="op">(</span>minute <span class="op">&lt;</span> <span class="dv">59</span><span class="op">)</span> minute<span class="op">++;</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>            minute <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>            <span class="cf">if</span><span class="op">(</span>hour <span class="op">&lt;</span> <span class="dv">23</span><span class="op">)</span> hour<span class="op">++;</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>            <span class="cf">else</span> hour <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>        <span class="op">}</span></span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="op">}</span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-timer_driver-3" class="slide level2">
<h2>Klasa <code>Timer_driver</code></h2>
<div class="sourceCode" id="cb8" data-startFrom="30"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 29;"><span id="cb8-30"><a href="#cb8-30"></a><span class="dt">void</span> Timer_driver<span class="op">::</span>set<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> h<span class="op">,</span> <span class="at">const</span> <span class="dt">int</span> m<span class="op">,</span> <span class="at">const</span> <span class="dt">int</span> s<span class="op">){</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>    hour <span class="op">=</span> h<span class="op">;</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>    minute <span class="op">=</span> m<span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>    second <span class="op">=</span> s<span class="op">;</span></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-timer_driver-4" class="slide level2">
<h2>Klasa <code>Timer_driver</code></h2>
<div class="sourceCode" id="cb9" data-startFrom="36"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 35;"><span id="cb9-36"><a href="#cb9-36"></a><span class="dt">void</span> Timer_driver<span class="op">::</span>get<span class="op">(</span><span class="dt">int</span><span class="op">*</span> h<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> m<span class="op">,</span> <span class="dt">int</span><span class="op">*</span> s<span class="op">)</span> <span class="at">const</span><span class="op">{</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb9-38"><a href="#cb9-38"></a>    <span class="op">*</span>h <span class="op">=</span> hour<span class="op">;</span></span>
<span id="cb9-39"><a href="#cb9-39"></a>    <span class="op">*</span>m <span class="op">=</span> minute<span class="op">;</span></span>
<span id="cb9-40"><a href="#cb9-40"></a>    <span class="op">*</span>s <span class="op">=</span> second<span class="op">;</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-sleep_driver" class="slide level2">
<h2>Klasa <code>Sleep_driver</code></h2>
<ul>
<li>Upotrebu klase <code>Driver</code> ilustruje i primer drajvera koji
omogućuje uspavljivanje jedne niti dok ne protekne zadani broj otkucaja
sata.</li>
<li>Ovo uspavljivanje može da se prikaže kao očekivanje dešavanja
zadanog broja otkucaja sata.</li>
<li>To opisuje klasa <code>Sleep_driver.</code></li>
<li>Njena operacija <code>simple_sleep_for()</code> omogućuje jednoj
niti da zaustavi svoju aktivnost dok se ne desi zadani broj otkucaja
sata.</li>
<li>Zadatak obrađivača prekida (operacije
<code>interrupt_handler()</code>) je da odbroji zadani broj otkucaja
sata i da nakon toga signalizira da je moguć nastavak aktivnosti
uspavane niti.</li>
</ul>
</section>
<section id="klasa-sleep_driver-1" class="slide level2">
<h2>Klasa Sleep_driver</h2>
<div class="sourceCode" id="cb10"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">class</span> Sleep_driver<span class="op">:</span> <span class="kw">public</span> Driver <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="at">static</span> <span class="dt">unsigned</span> <span class="dt">long</span> countdown<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">static</span> Event alarm<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">static</span> <span class="dt">void</span> interrupt_handler<span class="op">();</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw">public</span><span class="op">:</span> </span>
<span id="cb10-6"><a href="#cb10-6"></a>    Sleep_driver<span class="op">(</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>       <span class="op">{</span> start_interrupt_handling<span class="op">(</span>TIMER<span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>             interrupt_handler<span class="op">);</span> <span class="op">};</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="dt">void</span> simple_sleep_for<span class="op">(</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>             <span class="dt">unsigned</span> <span class="dt">long</span> duration<span class="op">);</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="klasa-sleep_driver-2" class="slide level2">
<h2>Klasa Sleep_driver</h2>
<div class="sourceCode" id="cb11" data-startFrom="12"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 11;"><span id="cb11-12"><a href="#cb11-12"></a><span class="dt">unsigned</span> <span class="dt">long</span> Sleep_driver<span class="op">::</span>countdown <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="dt">void</span> Sleep_driver<span class="op">::</span>interrupt_handler<span class="op">(){</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="cf">if</span><span class="op">((</span>countdown <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">((--</span>countdown<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">))</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>        alarm<span class="op">.</span>signal<span class="op">();</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-sleep_driver-3" class="slide level2">
<h2>Klasa Sleep_driver</h2>
<div class="sourceCode" id="cb12" data-startFrom="18"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 17;"><span id="cb12-18"><a href="#cb12-18"></a><span class="dt">void</span> Sleep_driver<span class="op">::</span>simple_sleep_for<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> duration<span class="op">){</span></span>
<span id="cb12-19"><a href="#cb12-19"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>    <span class="cf">if</span><span class="op">(</span>duration <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-21"><a href="#cb12-21"></a>        countdown <span class="op">=</span> duration<span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>        alarm<span class="op">.</span>expect<span class="op">();</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>    <span class="op">};</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="op">}</span></span></code></pre></div>
</section></section>
<section>
<section id="ulaznoizlazni-moduli" class="title-slide slide level1">
<h1>Ulazno/izlazni moduli</h1>

</section>
<section id="drajveri-tastature-i-ekrana" class="slide level2">
<h2>Drajveri tastature i ekrana</h2>
<ul>
<li>Klasa <code>Display_driver</code> sadrži drajver ekrana koji
upravlja kontrolerom ekrana.</li>
<li>Kontroler ekrana (objekat <code>display_controller</code>) sadrži
registar stanja (<code>display_controller.status_reg</code>) i registar
podataka (<code>display_controller.data_reg</code>).</li>
<li>Prikaz znaka na ekranu je moguć ako registar stanja sadrži konstantu
<code>DISPLAY_READY</code>.</li>
<li>U tom slučaju se kod znaka smešta u registar podataka, a u registar
stanja se smešta konstanta <code>DISPLAY_BUSY</code>.</li>
<li>Ova konstanta ostaje u registru stanja dok traje prikaz znaka.</li>
</ul>
</section>
<section id="drajveri-tastature-i-ekrana-1" class="slide level2">
<h2>Drajveri tastature i ekrana</h2>
<ul>
<li>Po prikazu znaka, kontroler ekrana smešta u registar stanja
konstantu <code>DISPLAY_READY</code> (podrazumeva se da se ova vrednost
nalazi u registru stanja na početku rada kontrolera ekrana).</li>
<li>Pokušaj niti da prikaže znak, dok je u registru stanja konstanta
<code>DISPLAY_BUSY</code>, zaustavlja aktivnost niti.</li>
<li>Nastavak aktivnosti niti usledi nakon obrade prekida ekrana, koja
objavljuje da je prikaz prethodnog znaka završen.</li>
</ul>
</section>
<section id="drajveri-tastature-i-ekrana-2" class="slide level2">
<h2>Drajveri tastature i ekrana</h2>
<ul>
<li>Zaustavljanje i nastavak aktivnosti niti omogućuje polje
<code>displayed_char</code> klase <code>Display_driver</code>.</li>
<li>Opisano ponašanje drajvera ekrana ostvaruju operacije
<code>character_put()</code> i <code>interrupt_handler()</code> klase
<code>Display_driver</code>.</li>
<li>Broj vektora prekida ekrana određuje konstanta
<code>DISPLAY</code>.</li>
</ul>
</section>
<section id="drajver-ekrana" class="slide level2">
<h2>Drajver Ekrana</h2>
<div class="sourceCode" id="cb13"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">class</span> Display_driver <span class="op">:</span> <span class="kw">public</span> Driver <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>        <span class="at">static</span> Event displayed_char<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>        <span class="at">static</span> <span class="dt">void</span> interrupt_handler<span class="op">();</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>        Display_driver<span class="op">(</span><span class="at">const</span> Display_driver<span class="op">&amp;);</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>        Display_driver<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Display_driver<span class="op">&amp;);</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="kw">public</span> <span class="op">:</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>        Display_driver<span class="op">()</span></span></code></pre></div>
</section>
<section id="drajver-ekrana-1" class="slide level2">
<h2>Drajver Ekrana</h2>
<div class="sourceCode" id="cb14" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb14-8"><a href="#cb14-8"></a>        <span class="op">{</span> start_interrupt_handling<span class="op">(</span>DISPLAY<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>          interrupt_handler<span class="op">);</span> <span class="op">};</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>        <span class="dt">void</span> character_put<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> c<span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="op">};</span></span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a>Display_driver<span class="op">::</span>Event</span>
<span id="cb14-14"><a href="#cb14-14"></a>Display_driver<span class="op">::</span>displayed_char<span class="op">;</span></span></code></pre></div>
</section>
<section id="drajver-ekrana-2" class="slide level2">
<h2>Drajver Ekrana</h2>
<div class="sourceCode" id="cb15" data-startFrom="15"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb15-15"><a href="#cb15-15"></a><span class="dt">void</span> Display_driver<span class="op">::</span>interrupt_handler<span class="op">()</span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>        displayed_char<span class="op">.</span>signal<span class="op">();</span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="drajver-ekrana-3" class="slide level2">
<h2>Drajver Ekrana</h2>
<div class="sourceCode" id="cb16" data-startFrom="19"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 18;"><span id="cb16-19"><a href="#cb16-19"></a><span class="dt">void</span> Display_driver<span class="op">::</span>character_put<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> c<span class="op">)</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="op">{</span></span>
<span id="cb16-21"><a href="#cb16-21"></a>        Atomic_region ar<span class="op">;</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>        <span class="cf">if</span><span class="op">(</span>display_controller<span class="op">.</span>status_reg <span class="op">==</span> DISPLAY_BUSY<span class="op">)</span></span>
<span id="cb16-23"><a href="#cb16-23"></a>                displayed_char<span class="op">.</span>expect<span class="op">();</span></span>
<span id="cb16-24"><a href="#cb16-24"></a>        display_controller<span class="op">.</span>data_reg <span class="op">=</span> c<span class="op">;</span></span>
<span id="cb16-25"><a href="#cb16-25"></a>        display_controller<span class="op">.</span>status_reg <span class="op">=</span> DISPLAY_BUSY<span class="op">;</span></span></code></pre></div>
</section>
<section id="drajver-ekrana-4" class="slide level2">
<h2>Drajver Ekrana</h2>
<div class="sourceCode" id="cb17" data-startFrom="26"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 25;"><span id="cb17-26"><a href="#cb17-26"></a><span class="op">}</span></span>
<span id="cb17-27"><a href="#cb17-27"></a></span>
<span id="cb17-28"><a href="#cb17-28"></a><span class="at">static</span> Display_driver display_driver<span class="op">;</span></span></code></pre></div>
</section>
<section id="drajver-tastature" class="slide level2">
<h2>Drajver tastature</h2>
<ul>
<li>Klasa <code>Keyboard_driver</code> sadrži drajver tastature koji
upravlja kontrolerom tastature.</li>
<li>Kontroler tastature (objekat <code>keyboard_controller</code>)
sadrži registar podataka
(<code>keyboard_controller.data_reg</code>).</li>
<li>Podrazumeva se da pritisak dirke na tastaturi:
<ul>
<li>dovede do smeštanja koda odgovarajućeg znaka u registar
podataka.</li>
<li>izazove prekid tastature.</li>
</ul></li>
<li>Pomenuti kod znaka se preuzima iz registra podataka u obradi prekida
tastature i smešta u cirkularni bafer, ako on nije pun.</li>
</ul>
</section>
<section id="drajver-tastature-1" class="slide level2">
<h2>Drajver tastature</h2>
<ul>
<li>Cirkularnom baferu odgovara polje buffer klase
<code>Keyboard_driver</code>.</li>
<li>Njeno polje <code>count</code> određuje popunjenost ovog
bafera.</li>
<li>Indekse cirkularnog bafera sadrže polja <code>first_full</code> i
<code>first_empty</code> klase <code>Keyboard_driver</code>.</li>
<li>Pokušaj niti da preuzme znak, kada je cirkularni bafer prazan,
zaustavlja njenu aktivnost.</li>
</ul>
</section>
<section id="drajver-tastature-2" class="slide level2">
<h2>Drajver tastature</h2>
<ul>
<li>Nastavak aktivnosti niti usledi nakon obrade prekida tastature.</li>
<li>Zaustavljanje i nastavak aktivnosti niti omogućije polje
<code>pressed</code> klase <code>Keyboard_driver</code>.</li>
<li>Opisano ponašanje drajvera tastature ostvaruju operacije
<code>character_get()</code> i <code>interrrupt_handler()</code> klase
<code>Keyboard_driver</code>.</li>
<li>Broj vektora prekida tastature određuje konstanta
<code>KEYBOARD</code>.</li>
</ul>
</section>
<section id="drajver-tastature-3" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb18"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1"></a><span class="at">const</span> <span class="dt">unsigned</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>KEYBOARD_BUFFER_SIZE <span class="op">=</span> <span class="dv">1024</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="kw">class</span> Keyboard_driver <span class="op">:</span> <span class="kw">public</span> Driver <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">static</span> Event pressed<span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="at">static</span> <span class="dt">char</span> buffer<span class="op">[</span>KEYBOARD_BUFFER_SIZE<span class="op">];</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="at">static</span> <span class="dt">unsigned</span> count<span class="op">;</span></span></code></pre></div>
</section>
<section id="drajver-tastature-4" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb19" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb19-8"><a href="#cb19-8"></a>    <span class="at">static</span> <span class="dt">unsigned</span> first_full<span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>    <span class="at">static</span> <span class="dt">unsigned</span> first_empty<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="at">static</span> <span class="dt">void</span> interrupt_handler<span class="op">();</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>    Keyboard_driver<span class="op">(</span><span class="at">const</span> Keyboard_driver<span class="op">&amp;);</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>    Keyboard_driver<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Keyboard_driver<span class="op">&amp;);</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb19-14"><a href="#cb19-14"></a>    Keyboard_driver<span class="op">()</span></span></code></pre></div>
</section>
<section id="drajver-tastature-5" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb20" data-startFrom="15"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb20-15"><a href="#cb20-15"></a>    <span class="op">{</span> start_interrupt_handling<span class="op">(</span>KEYBOARD<span class="op">,</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>      interrupt_handler<span class="op">);</span> <span class="op">};</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>    <span class="dt">char</span> character_get<span class="op">();</span></span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="op">};</span></span>
<span id="cb20-19"><a href="#cb20-19"></a></span>
<span id="cb20-20"><a href="#cb20-20"></a>Keyboard_driver<span class="op">::</span>Event</span>
<span id="cb20-21"><a href="#cb20-21"></a>Keyboard_driver<span class="op">::</span>pressed<span class="op">;</span></span></code></pre></div>
</section>
<section id="drajver-tastature-6" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb21" data-startFrom="22"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 21;"><span id="cb21-22"><a href="#cb21-22"></a><span class="dt">char</span> Keyboard_driver<span class="op">::</span>buffer<span class="op">[</span>KEYBOARD_BUFFER_SIZE<span class="op">];</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="dt">unsigned</span> Keyboard_driver<span class="op">::</span>count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="dt">unsigned</span> Keyboard_driver<span class="op">::</span>first_full <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="dt">unsigned</span> Keyboard_driver<span class="op">::</span>first_empty <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-26"><a href="#cb21-26"></a></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="dt">void</span> Keyboard_driver<span class="op">::</span>interrupt_handler<span class="op">(){</span></span>
<span id="cb21-28"><a href="#cb21-28"></a>    <span class="cf">if</span><span class="op">(</span>count<span class="op">&lt;</span>KEYBOARD_BUFFER_SIZE<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="drajver-tastature-7" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb22" data-startFrom="29"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 28;"><span id="cb22-29"><a href="#cb22-29"></a>        buffer<span class="op">[</span>first_empty<span class="op">++]</span> <span class="op">=</span></span>
<span id="cb22-30"><a href="#cb22-30"></a>        keyboard_controller<span class="op">.</span>data_reg<span class="op">;</span></span>
<span id="cb22-31"><a href="#cb22-31"></a>        <span class="cf">if</span><span class="op">(</span>first_empty <span class="op">==</span> KEYBOARD_BUFFER_SIZE<span class="op">)</span></span>
<span id="cb22-32"><a href="#cb22-32"></a>            first_empty <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-33"><a href="#cb22-33"></a>        count<span class="op">++;</span></span>
<span id="cb22-34"><a href="#cb22-34"></a>        pressed<span class="op">.</span>signal<span class="op">();</span></span>
<span id="cb22-35"><a href="#cb22-35"></a>    <span class="op">}</span></span>
<span id="cb22-36"><a href="#cb22-36"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="drajver-tastature-8" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb23" data-startFrom="37"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 36;"><span id="cb23-37"><a href="#cb23-37"></a><span class="dt">char</span> Keyboard_driver<span class="op">::</span>character_get<span class="op">(){</span></span>
<span id="cb23-38"><a href="#cb23-38"></a>    <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb23-39"><a href="#cb23-39"></a>    Atomic_region ar<span class="op">;</span></span>
<span id="cb23-40"><a href="#cb23-40"></a>    <span class="cf">if</span><span class="op">(</span>count<span class="op">==</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb23-41"><a href="#cb23-41"></a>        pressed<span class="op">.</span>expect<span class="op">();</span></span></code></pre></div>
</section>
<section id="drajver-tastature-9" class="slide level2">
<h2>Drajver Tastature</h2>
<div class="sourceCode" id="cb24" data-startFrom="42"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 41;"><span id="cb24-42"><a href="#cb24-42"></a>    c <span class="op">=</span> buffer<span class="op">[</span>first_full<span class="op">++];</span></span>
<span id="cb24-43"><a href="#cb24-43"></a>    <span class="cf">if</span><span class="op">(</span>first_full <span class="op">==</span> KEYBOARD_BUFFER_SIZE<span class="op">)</span></span>
<span id="cb24-44"><a href="#cb24-44"></a>        first_full <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-45"><a href="#cb24-45"></a>    count<span class="op">--;</span></span>
<span id="cb24-46"><a href="#cb24-46"></a>    <span class="cf">return</span> c<span class="op">;</span></span>
<span id="cb24-47"><a href="#cb24-47"></a><span class="op">}</span></span>
<span id="cb24-48"><a href="#cb24-48"></a><span class="at">static</span> Keyboard_driver keyboard_driver<span class="op">;</span></span></code></pre></div>
</section>
<section id="znakovni-ulaz-izlaz" class="slide level2">
<h2>Znakovni ulaz-izlaz</h2>
<ul>
<li>Prilikom ulaza-izlaza znakova moguća su štetna preplitanja.
Sprečavanje štetnih preplitanja ulaznih i izlaznih operacija podrazumeva
da su one međusobno isključive.</li>
<li>Njihova međusobna isključivost se može ostvariti, ako se tastatura,
odnosno ekran zaključa (zauzme) pre i otključa (oslobodi) nakon
korišćenja, prilikom svakog izvršavanja odgovarajuće operacije.</li>
</ul>
</section>
<section id="znakovni-ulaz-izlaz-1" class="slide level2">
<h2>Znakovni ulaz-izlaz</h2>
<ul>
<li>Neuspešan pokušaj zaključavanja uređaja dovodi do zaustavljanja
izvršavanja ovakve operacije, dok zaključavanje ne postane moguće.</li>
<li>Zaključavanje tastature i ekrana, tokom izvršavanja ulaznih i
izlaznih operacija, se zasniva na korišćenju propusnica.</li>
<li>Posebne propusnice reprezentuju ekran i tastaturu.</li>
<li>Zauzimanje propusnice odgovara zaključavanju njenog uređaja, a
oslobađanje propusnice odgovara otključavanju dotičnog uređaja.</li>
<li>Time se obezbeđuje međusobna isključivost pojedinačnih ulaznih i
izlaznih operacija.</li>
</ul>
</section>
<section id="znakovni-ulaz-izlaz-2" class="slide level2">
<h2>Znakovni ulaz-izlaz</h2>
<ul>
<li>Klasa <code>Terminal_out</code> omogućuje znakovni izlaz, odnosno
prikaz znaknova na ekranu.</li>
<li>Ona sadrži operacije koje omogućuju formatiranje prikazivanog
podatka (njegovo pretvaranje u niz znakova).</li>
<li>Oznake <code>%6d</code>, <code>%6u</code>, <code>%11d</code> i
<code>%11u</code> određuju broj cifara u decimalnom formatu u kome se
prikazuju cifre celih označenih (d) i neoznačenih (u) brojeva, a oznaka
<code>%.3e</code> određuje broj cifara iza decimalne tačke u decimalnom
formatu u kome se prikazuju cifre razlomljenih brojeva.</li>
<li>Za prikaz niza znakova (znakovni izlaz) zadužena je operacija
<code>string_put()</code> klase <code>Terminal_out</code>, koja se brine
i o zaključavanju ekrana.</li>
</ul>
</section>
<section id="klasa-terminal_out" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb25"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1"></a><span class="at">const</span> <span class="dt">char</span> endl<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="kw">class</span> Terminal_out <span class="op">:</span> <span class="kw">private</span> mutex <span class="op">{</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>    Terminal_out<span class="op">(</span><span class="at">const</span> Terminal_out<span class="op">&amp;);</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Terminal_out<span class="op">&amp;);</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="dt">void</span> string_put<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> string<span class="op">);</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="kw">public</span><span class="op">:</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-1" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb26" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb26-8"><a href="#cb26-8"></a>    Terminal_out<span class="op">()</span> <span class="op">{};</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">int</span> number<span class="op">);</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">int</span> number<span class="op">);</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">short</span> number<span class="op">);</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">short</span> number<span class="op">);</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">long</span> number<span class="op">);</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">long</span> number<span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-2" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb27" data-startFrom="15"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb27-15"><a href="#cb27-15"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">double</span> number<span class="op">);</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">char</span> character<span class="op">);</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>    Terminal_out<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> string<span class="op">);</span></span>
<span id="cb27-18"><a href="#cb27-18"></a>    <span class="kw">friend</span> <span class="kw">class</span> Terminal_in<span class="op">;</span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="op">};</span></span>
<span id="cb27-20"><a href="#cb27-20"></a></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> SHORT_FORMAT <span class="op">=</span> <span class="st">&quot;</span><span class="sc">%6d</span><span class="st">&quot;</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-3" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb28" data-startFrom="22"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 21;"><span id="cb28-22"><a href="#cb28-22"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> UNSIGNED_SHORT_FORMAT <span class="op">=</span> <span class="st">&quot;</span><span class="sc">%6u</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> INT_FORMAT <span class="op">=</span> <span class="st">&quot;</span><span class="sc">%11d</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> UNSIGNED_FORMAT <span class="op">=</span> <span class="st">&quot;</span><span class="sc">%11u</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> DOUBLE_FORMAT <span class="op">=</span> <span class="st">&quot;</span><span class="sc">% .3e</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> SHORT_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb28-27"><a href="#cb28-27"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> INT_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> DOUBLE_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-4" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb29" data-startFrom="29"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 28;"><span id="cb29-29"><a href="#cb29-29"></a></span>
<span id="cb29-30"><a href="#cb29-30"></a><span class="dt">void</span> Terminal_out<span class="op">::</span>string_put<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> string<span class="op">)</span></span>
<span id="cb29-31"><a href="#cb29-31"></a><span class="op">{</span></span>
<span id="cb29-32"><a href="#cb29-32"></a>    lock<span class="op">();</span></span>
<span id="cb29-33"><a href="#cb29-33"></a>    <span class="cf">while</span><span class="op">(*</span>string <span class="op">!=</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">)</span></span>
<span id="cb29-34"><a href="#cb29-34"></a>        display_driver<span class="op">.</span>character_put<span class="op">(*</span>string<span class="op">++);</span></span>
<span id="cb29-35"><a href="#cb29-35"></a>    unlock<span class="op">();</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-5" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb30" data-startFrom="36"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 35;"><span id="cb30-36"><a href="#cb30-36"></a><span class="op">}</span></span>
<span id="cb30-37"><a href="#cb30-37"></a></span>
<span id="cb30-38"><a href="#cb30-38"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">int</span> number<span class="op">)</span></span>
<span id="cb30-39"><a href="#cb30-39"></a><span class="op">{</span></span>
<span id="cb30-40"><a href="#cb30-40"></a>    <span class="dt">char</span> string<span class="op">[</span>INT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb30-41"><a href="#cb30-41"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> INT_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb30-42"><a href="#cb30-42"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-6" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb31" data-startFrom="43"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 42;"><span id="cb31-43"><a href="#cb31-43"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb31-44"><a href="#cb31-44"></a><span class="op">}</span></span>
<span id="cb31-45"><a href="#cb31-45"></a></span>
<span id="cb31-46"><a href="#cb31-46"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">int</span> number<span class="op">)</span></span>
<span id="cb31-47"><a href="#cb31-47"></a><span class="op">{</span></span>
<span id="cb31-48"><a href="#cb31-48"></a>    <span class="dt">char</span> string<span class="op">[</span>INT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb31-49"><a href="#cb31-49"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> UNSIGNED_FORMAT<span class="op">,</span> number<span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-7" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb32" data-startFrom="50"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 49;"><span id="cb32-50"><a href="#cb32-50"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb32-51"><a href="#cb32-51"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb32-52"><a href="#cb32-52"></a><span class="op">}</span></span>
<span id="cb32-53"><a href="#cb32-53"></a></span>
<span id="cb32-54"><a href="#cb32-54"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">short</span> number<span class="op">)</span></span>
<span id="cb32-55"><a href="#cb32-55"></a><span class="op">{</span></span>
<span id="cb32-56"><a href="#cb32-56"></a>    <span class="dt">char</span> string<span class="op">[</span>SHORT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-8" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb33" data-startFrom="57"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 56;"><span id="cb33-57"><a href="#cb33-57"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> SHORT_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb33-58"><a href="#cb33-58"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb33-59"><a href="#cb33-59"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb33-60"><a href="#cb33-60"></a><span class="op">}</span></span>
<span id="cb33-61"><a href="#cb33-61"></a></span>
<span id="cb33-62"><a href="#cb33-62"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">short</span> number<span class="op">)</span></span>
<span id="cb33-63"><a href="#cb33-63"></a><span class="op">{</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-9" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb34" data-startFrom="64"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 63;"><span id="cb34-64"><a href="#cb34-64"></a>    <span class="dt">char</span> string<span class="op">[</span>SHORT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb34-65"><a href="#cb34-65"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> UNSIGNED_SHORT_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb34-66"><a href="#cb34-66"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb34-67"><a href="#cb34-67"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb34-68"><a href="#cb34-68"></a><span class="op">}</span></span>
<span id="cb34-69"><a href="#cb34-69"></a></span>
<span id="cb34-70"><a href="#cb34-70"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">long</span> number<span class="op">)</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-10" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb35" data-startFrom="71"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 70;"><span id="cb35-71"><a href="#cb35-71"></a><span class="op">{</span></span>
<span id="cb35-72"><a href="#cb35-72"></a>    <span class="dt">char</span> string<span class="op">[</span>INT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb35-73"><a href="#cb35-73"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> INT_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb35-74"><a href="#cb35-74"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb35-75"><a href="#cb35-75"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb35-76"><a href="#cb35-76"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-11" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb36" data-startFrom="77"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 76;"><span id="cb36-77"><a href="#cb36-77"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">unsigned</span> <span class="dt">long</span> number<span class="op">)</span></span>
<span id="cb36-78"><a href="#cb36-78"></a><span class="op">{</span></span>
<span id="cb36-79"><a href="#cb36-79"></a>    <span class="dt">char</span> string<span class="op">[</span>INT_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb36-80"><a href="#cb36-80"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> UNSIGNED_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb36-81"><a href="#cb36-81"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb36-82"><a href="#cb36-82"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb36-83"><a href="#cb36-83"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-12" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb37" data-startFrom="84"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 83;"><span id="cb37-84"><a href="#cb37-84"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">double</span> number<span class="op">)</span></span>
<span id="cb37-85"><a href="#cb37-85"></a><span class="op">{</span></span>
<span id="cb37-86"><a href="#cb37-86"></a>    <span class="dt">char</span> string<span class="op">[</span>DOUBLE_SIGNIFICANT_FIGURES_COUNT <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span>
<span id="cb37-87"><a href="#cb37-87"></a>    sprintf<span class="op">(</span>string<span class="op">,</span> DOUBLE_FORMAT<span class="op">,</span> number<span class="op">);</span></span>
<span id="cb37-88"><a href="#cb37-88"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb37-89"><a href="#cb37-89"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb37-90"><a href="#cb37-90"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-13" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb38" data-startFrom="91"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 90;"><span id="cb38-91"><a href="#cb38-91"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="dt">char</span> character<span class="op">)</span></span>
<span id="cb38-92"><a href="#cb38-92"></a><span class="op">{</span></span>
<span id="cb38-93"><a href="#cb38-93"></a>    <span class="dt">char</span> string<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb38-94"><a href="#cb38-94"></a>    string<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> character<span class="op">;</span></span>
<span id="cb38-95"><a href="#cb38-95"></a>    string<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-14" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb39" data-startFrom="96"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 95;"><span id="cb39-96"><a href="#cb39-96"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span>
<span id="cb39-97"><a href="#cb39-97"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb39-98"><a href="#cb39-98"></a><span class="op">}</span></span>
<span id="cb39-99"><a href="#cb39-99"></a></span>
<span id="cb39-100"><a href="#cb39-100"></a>Terminal_out<span class="op">&amp;</span> Terminal_out<span class="op">::</span><span class="kw">operator</span><span class="op">&lt;&lt;(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> string<span class="op">)</span></span>
<span id="cb39-101"><a href="#cb39-101"></a><span class="op">{</span></span>
<span id="cb39-102"><a href="#cb39-102"></a>    string_put<span class="op">(</span>string<span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_out-15" class="slide level2">
<h2>Klasa <code>Terminal_out</code></h2>
<div class="sourceCode" id="cb40" data-startFrom="103"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 102;"><span id="cb40-103"><a href="#cb40-103"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb40-104"><a href="#cb40-104"></a><span class="op">}</span></span>
<span id="cb40-105"><a href="#cb40-105"></a></span>
<span id="cb40-106"><a href="#cb40-106"></a>Terminal_out cout<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in" class="slide level2">
<h2>Klasa Terminal_in</h2>
<ul>
<li>Klasa Terminal_in omogućuje preuzimanje znakova (znakovni
ulaz).</li>
<li>Ona obezbeđuje zaključavanje tastature dok se izvršava njena
operacija <code>string_get()</code>, kao i zaključavanje ekrana, radi
eha znakova, preuzetih u ovoj operaciji.</li>
<li>Operacija <code>string_get()</code> poziva operaciju
<code>edit()</code> klase <code>Terminal_in</code> koja je zadužena za
eho znakova na ekranu i njihovo primitivno editiranje.</li>
<li>Preostale operacije klase <code>Terminal_in</code> koriste operaciju
<code>string_get()</code> za preuzimanje nizova znakova koji odgovaraju
raznim tipovima podataka.</li>
</ul>
</section>
<section id="klasa-terminal_in-1" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb41"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1"></a><span class="at">const</span> <span class="dt">int</span> INPUT_BUFFER_LENGTH <span class="op">=</span> <span class="dv">128</span><span class="op">;</span></span>
<span id="cb41-2"><a href="#cb41-2"></a></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">class</span> Terminal_in <span class="op">:</span> <span class="kw">private</span> mutex <span class="op">{</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    Terminal_in<span class="op">(</span><span class="at">const</span> Terminal_in<span class="op">&amp;);</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Terminal_in<span class="op">&amp;);</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="dt">unsigned</span> index<span class="op">;</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="dt">char</span> c<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-2" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb42" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb42-8"><a href="#cb42-8"></a>    <span class="dt">bool</span> pressed_enter<span class="op">;</span></span>
<span id="cb42-9"><a href="#cb42-9"></a>    <span class="dt">char</span> buff<span class="op">[</span>INPUT_BUFFER_LENGTH<span class="op">];</span></span>
<span id="cb42-10"><a href="#cb42-10"></a>    <span class="kw">inline</span> <span class="dt">void</span> edit<span class="op">();</span></span>
<span id="cb42-11"><a href="#cb42-11"></a>    <span class="dt">void</span> string_get<span class="op">(</span><span class="dt">unsigned</span> figures_count<span class="op">);</span></span>
<span id="cb42-12"><a href="#cb42-12"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb42-13"><a href="#cb42-13"></a>    Terminal_in<span class="op">()</span> <span class="op">{};</span></span>
<span id="cb42-14"><a href="#cb42-14"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">int</span> <span class="op">&amp;</span>number<span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-3" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb43" data-startFrom="15"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb43-15"><a href="#cb43-15"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">short</span> <span class="op">&amp;</span>number<span class="op">);</span></span>
<span id="cb43-16"><a href="#cb43-16"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">long</span> <span class="op">&amp;</span>number<span class="op">);</span></span>
<span id="cb43-17"><a href="#cb43-17"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">double</span> <span class="op">&amp;</span>number<span class="op">);</span></span>
<span id="cb43-18"><a href="#cb43-18"></a>    Terminal_in<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">char</span> <span class="op">&amp;</span>character<span class="op">);</span></span>
<span id="cb43-19"><a href="#cb43-19"></a><span class="op">};</span></span>
<span id="cb43-20"><a href="#cb43-20"></a></span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> SHORT_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-4" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb44" data-startFrom="22"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 21;"><span id="cb44-22"><a href="#cb44-22"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> INT_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb44-23"><a href="#cb44-23"></a><span class="at">static</span> <span class="at">const</span> <span class="dt">int</span> DOUBLE_SIGNIFICANT_FIGURES_COUNT <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb44-24"><a href="#cb44-24"></a></span>
<span id="cb44-25"><a href="#cb44-25"></a><span class="pp">#define CHAR_ESC </span><span class="op">(</span><span class="dv">27</span><span class="op">)</span></span>
<span id="cb44-26"><a href="#cb44-26"></a><span class="pp">#define CHAR_LF </span><span class="op">(</span><span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">)</span></span>
<span id="cb44-27"><a href="#cb44-27"></a><span class="pp">#define CHAR_BS1 </span><span class="op">(</span><span class="ch">&#39;</span><span class="sc">\b</span><span class="ch">&#39;</span><span class="op">)</span></span>
<span id="cb44-28"><a href="#cb44-28"></a><span class="pp">#define CHAR_BS2 </span><span class="op">(</span><span class="dv">127</span><span class="op">)</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-5" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb45" data-startFrom="29"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 28;"><span id="cb45-29"><a href="#cb45-29"></a></span>
<span id="cb45-30"><a href="#cb45-30"></a><span class="dt">void</span> Terminal_in<span class="op">::</span>edit<span class="op">()</span> <span class="co">//radi eho znakova preuzetih sa tastature na ekran</span></span>
<span id="cb45-31"><a href="#cb45-31"></a><span class="op">{</span></span>
<span id="cb45-32"><a href="#cb45-32"></a>    <span class="cf">switch</span><span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-33"><a href="#cb45-33"></a>        <span class="cf">case</span> CHAR_ESC<span class="op">:</span></span>
<span id="cb45-34"><a href="#cb45-34"></a>            buff<span class="op">[</span>index<span class="op">++]=</span>c<span class="op">;</span></span>
<span id="cb45-35"><a href="#cb45-35"></a>            display_driver<span class="op">.</span>character_put<span class="op">(</span><span class="ch">&#39;^&#39;</span><span class="op">);</span> <span class="co">//esc caret karakter</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-6" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb46" data-startFrom="36"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 35;"><span id="cb46-36"><a href="#cb46-36"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb46-37"><a href="#cb46-37"></a>        <span class="cf">case</span> CHAR_LF<span class="op">:</span></span>
<span id="cb46-38"><a href="#cb46-38"></a>            pressed_enter <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb46-39"><a href="#cb46-39"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb46-40"><a href="#cb46-40"></a>        <span class="cf">case</span> CHAR_BS1<span class="op">:</span></span>
<span id="cb46-41"><a href="#cb46-41"></a>        <span class="cf">case</span> CHAR_BS2<span class="op">:</span></span>
<span id="cb46-42"><a href="#cb46-42"></a>            <span class="cf">if</span><span class="op">(</span>index<span class="op">&gt;</span><span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-7" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb47" data-startFrom="43"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 42;"><span id="cb47-43"><a href="#cb47-43"></a>                buff<span class="op">[--</span>index<span class="op">]=</span><span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb47-44"><a href="#cb47-44"></a>                display_driver<span class="op">.</span>character_put<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\b</span><span class="ch">&#39;</span><span class="op">);</span> <span class="co">//pomeranje kursora nazad</span></span>
<span id="cb47-45"><a href="#cb47-45"></a>                display_driver<span class="op">.</span>character_put<span class="op">(</span><span class="ch">&#39; &#39;</span><span class="op">);</span>  <span class="co">//stavljanje space-a</span></span>
<span id="cb47-46"><a href="#cb47-46"></a>                display_driver<span class="op">.</span>character_put<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\b</span><span class="ch">&#39;</span><span class="op">);</span> <span class="co">//pomeranje kursora nazad</span></span>
<span id="cb47-47"><a href="#cb47-47"></a>            <span class="op">}</span></span>
<span id="cb47-48"><a href="#cb47-48"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb47-49"><a href="#cb47-49"></a>        <span class="cf">default</span><span class="op">:</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-8" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb48" data-startFrom="50"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 49;"><span id="cb48-50"><a href="#cb48-50"></a>            buff<span class="op">[</span>index<span class="op">++]=</span>c<span class="op">;</span></span>
<span id="cb48-51"><a href="#cb48-51"></a>            display_driver<span class="op">.</span>character_put<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb48-52"><a href="#cb48-52"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb48-53"><a href="#cb48-53"></a>    <span class="op">}</span></span>
<span id="cb48-54"><a href="#cb48-54"></a>    buff<span class="op">[</span>index<span class="op">]=</span><span class="ch">&#39;</span><span class="sc">\0</span><span class="ch">&#39;</span><span class="op">;</span></span>
<span id="cb48-55"><a href="#cb48-55"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-9" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb49" data-startFrom="56"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 55;"><span id="cb49-56"><a href="#cb49-56"></a><span class="dt">void</span> Terminal_in<span class="op">::</span>string_get<span class="op">(</span><span class="dt">unsigned</span> figures_count<span class="op">)</span></span>
<span id="cb49-57"><a href="#cb49-57"></a><span class="op">{</span></span>
<span id="cb49-58"><a href="#cb49-58"></a>    lock<span class="op">();</span>                         <span class="co">//zakljucaj tastaturu</span></span>
<span id="cb49-59"><a href="#cb49-59"></a>    index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb49-60"><a href="#cb49-60"></a>    pressed_enter <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb49-61"><a href="#cb49-61"></a>    c <span class="op">=</span> keyboard_driver<span class="op">.</span>character_get<span class="op">();</span></span>
<span id="cb49-62"><a href="#cb49-62"></a>    cout<span class="op">.</span>lock<span class="op">();</span>                 <span class="co">//zakljucaj terminal</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-10" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb50" data-startFrom="63"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 62;"><span id="cb50-63"><a href="#cb50-63"></a>    edit<span class="op">();</span>                      <span class="co">//ispisi prvi karakter</span></span>
<span id="cb50-64"><a href="#cb50-64"></a>    <span class="cf">while</span><span class="op">((</span>index <span class="op">&lt;</span> <span class="op">(</span>figures_count <span class="op">-</span> <span class="dv">1</span><span class="op">))</span> <span class="op">&amp;&amp;</span></span>
<span id="cb50-65"><a href="#cb50-65"></a>             <span class="op">!</span>pressed_enter<span class="op">)</span> <span class="op">{</span>  <span class="co">//ispisuj do entera tj. do precizn.</span></span>
<span id="cb50-66"><a href="#cb50-66"></a>        c <span class="op">=</span> keyboard_driver<span class="op">.</span>character_get<span class="op">();</span></span>
<span id="cb50-67"><a href="#cb50-67"></a>        edit<span class="op">();</span></span>
<span id="cb50-68"><a href="#cb50-68"></a>    <span class="op">}</span></span>
<span id="cb50-69"><a href="#cb50-69"></a>    cout<span class="op">.</span>unlock<span class="op">();</span>              <span class="co">//otkljucaj terminal</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-11" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb51" data-startFrom="70"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 69;"><span id="cb51-70"><a href="#cb51-70"></a>    unlock<span class="op">();</span>                     <span class="co">//otkljucaj tastaturu</span></span>
<span id="cb51-71"><a href="#cb51-71"></a><span class="op">}</span></span>
<span id="cb51-72"><a href="#cb51-72"></a></span>
<span id="cb51-73"><a href="#cb51-73"></a>Terminal_in<span class="op">&amp;</span> Terminal_in<span class="op">::</span><span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">int</span><span class="op">&amp;</span> number<span class="op">)</span></span>
<span id="cb51-74"><a href="#cb51-74"></a><span class="op">{</span></span>
<span id="cb51-75"><a href="#cb51-75"></a>    string_get<span class="op">(</span>INT_SIGNIFICANT_FIGURES_COUNT<span class="op">);</span></span>
<span id="cb51-76"><a href="#cb51-76"></a>    number <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>strtol<span class="op">(</span>buff<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-12" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb52" data-startFrom="77"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 76;"><span id="cb52-77"><a href="#cb52-77"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb52-78"><a href="#cb52-78"></a><span class="op">}</span></span>
<span id="cb52-79"><a href="#cb52-79"></a></span>
<span id="cb52-80"><a href="#cb52-80"></a>Terminal_in<span class="op">&amp;</span> Terminal_in<span class="op">::</span><span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">short</span><span class="op">&amp;</span> number<span class="op">)</span></span>
<span id="cb52-81"><a href="#cb52-81"></a><span class="op">{</span></span>
<span id="cb52-82"><a href="#cb52-82"></a>    string_get<span class="op">(</span>SHORT_SIGNIFICANT_FIGURES_COUNT<span class="op">);</span></span>
<span id="cb52-83"><a href="#cb52-83"></a>    number <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>strtol<span class="op">(</span>buff<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-13" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb53" data-startFrom="84"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 83;"><span id="cb53-84"><a href="#cb53-84"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb53-85"><a href="#cb53-85"></a><span class="op">}</span></span>
<span id="cb53-86"><a href="#cb53-86"></a></span>
<span id="cb53-87"><a href="#cb53-87"></a>Terminal_in<span class="op">&amp;</span> Terminal_in<span class="op">::</span><span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">long</span><span class="op">&amp;</span> number<span class="op">)</span></span>
<span id="cb53-88"><a href="#cb53-88"></a><span class="op">{</span></span>
<span id="cb53-89"><a href="#cb53-89"></a>    string_get<span class="op">(</span>INT_SIGNIFICANT_FIGURES_COUNT<span class="op">);</span></span>
<span id="cb53-90"><a href="#cb53-90"></a>    number <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>strtol<span class="op">(</span>buff<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-14" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb54" data-startFrom="91"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 90;"><span id="cb54-91"><a href="#cb54-91"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb54-92"><a href="#cb54-92"></a><span class="op">}</span></span>
<span id="cb54-93"><a href="#cb54-93"></a></span>
<span id="cb54-94"><a href="#cb54-94"></a>Terminal_in<span class="op">&amp;</span> Terminal_in<span class="op">::</span><span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">double</span><span class="op">&amp;</span> number<span class="op">)</span></span>
<span id="cb54-95"><a href="#cb54-95"></a><span class="op">{</span></span>
<span id="cb54-96"><a href="#cb54-96"></a>    string_get<span class="op">(</span>DOUBLE_SIGNIFICANT_FIGURES_COUNT<span class="op">);</span></span>
<span id="cb54-97"><a href="#cb54-97"></a>    number <span class="op">=</span> strtod<span class="op">(</span>buff<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-15" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb55" data-startFrom="98"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 97;"><span id="cb55-98"><a href="#cb55-98"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb55-99"><a href="#cb55-99"></a><span class="op">}</span></span>
<span id="cb55-100"><a href="#cb55-100"></a></span>
<span id="cb55-101"><a href="#cb55-101"></a>Terminal_in<span class="op">&amp;</span> Terminal_in<span class="op">::</span><span class="kw">operator</span><span class="op">&gt;&gt;(</span><span class="dt">char</span><span class="op">&amp;</span> character<span class="op">)</span></span>
<span id="cb55-102"><a href="#cb55-102"></a><span class="op">{</span></span>
<span id="cb55-103"><a href="#cb55-103"></a>    string_get<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb55-104"><a href="#cb55-104"></a>    character <span class="op">=</span> buff<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span></code></pre></div>
</section>
<section id="klasa-terminal_in-16" class="slide level2">
<h2>Klasa <code>Terminal_in</code></h2>
<div class="sourceCode" id="cb56" data-startFrom="105"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 104;"><span id="cb56-105"><a href="#cb56-105"></a>    <span class="cf">return</span> <span class="op">*</span><span class="kw">this</span><span class="op">;</span></span>
<span id="cb56-106"><a href="#cb56-106"></a><span class="op">}</span></span>
<span id="cb56-107"><a href="#cb56-107"></a></span>
<span id="cb56-108"><a href="#cb56-108"></a>Terminal_in cin<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<ul>
<li>Klasa <code>Disk_driver</code> sadrži drajver diska koji upravlja
DMA kontrolerom diska.</li>
<li>DMA kontroler diska (objekat <code>disk_controller</code>) sadrži:
<ul>
<li>registar bloka (<code>disk_controller.block_reg</code>)</li>
<li>registar bafera (<code>disk_controller.buffer_reg</code>)</li>
<li>registar smera prenosa
(<code>disk_controller.operation_reg</code>)</li>
<li>registar stanja (<code>disk_controller.status_reg</code>).</li>
</ul></li>
</ul>
</section>
<section id="klasa-disk_driver-1" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<ul>
<li>Podrazumeva se da nit pokreće prenos bloka tako što:
<ul>
<li>u registar bloka smesti broj prenošenog bloka</li>
<li>u registar bafera smesti adresu bafera koji učestvuje u prenosu</li>
<li>u registar smera prenosa smesti konstantu <code>DISK_READ</code> ili
<code>DISK_WRITE</code></li>
<li>u registar stanja konstantu <code>DISK_STARTED</code></li>
</ul></li>
</ul>
</section>
<section id="klasa-disk_driver-2" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<ul>
<li>Nakon toga aktivnost niti se zaustavi dok traje prenos bloka.</li>
<li>Kraj prenosa bloka objavi prekid diska.</li>
<li>Zaustavljanje i nastavak aktivnostiniti omogućuje polje ready klase
<code>Disk_driver</code>. Opisano ponašanje drajvera diska ostvaruju
operacije <code>block_transfer()</code> i
<code>interrupt_handler()</code> klase <code>Disk_driver</code>.</li>
<li>Broj vektora prekida diska određuje konstanta
<code>DISK</code>.</li>
</ul>
</section>
<section id="klasa-disk_driver-3" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb57"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">class</span> Disk_driver <span class="op">:</span> <span class="kw">public</span> Driver <span class="op">{</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>    <span class="at">static</span> Event ready<span class="op">;</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>    <span class="at">static</span> <span class="dt">void</span> interrupt_handler<span class="op">();</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>    Disk_driver<span class="op">(</span><span class="at">const</span> Disk_driver <span class="op">&amp;);</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>    Disk_driver<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Disk_driver <span class="op">&amp;);</span></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb57-7"><a href="#cb57-7"></a>    Disk_driver<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span> start_interrupt_handling<span class="op">(</span>DISK<span class="op">,</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver-4" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb58" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb58-8"><a href="#cb58-8"></a>                            interrupt_handler<span class="op">);</span> <span class="op">}</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>    <span class="kw">inline</span> <span class="dt">int</span> block_transfer<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">,</span></span>
<span id="cb58-10"><a href="#cb58-10"></a>                            Disk_operations operation<span class="op">);</span></span>
<span id="cb58-11"><a href="#cb58-11"></a><span class="op">};</span></span>
<span id="cb58-12"><a href="#cb58-12"></a>Disk_driver<span class="op">::</span>Event Disk_driver<span class="op">::</span>ready<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver-5" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb59" data-startFrom="13"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 12;"><span id="cb59-13"><a href="#cb59-13"></a><span class="dt">void</span> Disk_driver<span class="op">::</span>interrupt_handler<span class="op">()</span></span>
<span id="cb59-14"><a href="#cb59-14"></a><span class="op">{</span></span>
<span id="cb59-15"><a href="#cb59-15"></a>    ready<span class="op">.</span>signal<span class="op">();</span></span>
<span id="cb59-16"><a href="#cb59-16"></a><span class="op">}</span></span>
<span id="cb59-17"><a href="#cb59-17"></a></span>
<span id="cb59-18"><a href="#cb59-18"></a><span class="dt">int</span> Disk_driver<span class="op">::</span>block_transfer<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span></span>
<span id="cb59-19"><a href="#cb59-19"></a>                <span class="dt">unsigned</span> block<span class="op">,</span> Disk_operations operation<span class="op">)</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver-6" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb60" data-startFrom="20"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 19;"><span id="cb60-20"><a href="#cb60-20"></a><span class="op">{</span></span>
<span id="cb60-21"><a href="#cb60-21"></a>    <span class="dt">int</span> r <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb60-22"><a href="#cb60-22"></a>    <span class="cf">if</span><span class="op">(</span>block <span class="op">&lt;</span> DISK_BLOCKS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb60-23"><a href="#cb60-23"></a>        Atomic_region ar<span class="op">;</span></span>
<span id="cb60-24"><a href="#cb60-24"></a>        disk_controller<span class="op">.</span>block_reg <span class="op">=</span> block<span class="op">;</span></span>
<span id="cb60-25"><a href="#cb60-25"></a>        disk_controller<span class="op">.</span>buffer_reg <span class="op">=</span> buffer<span class="op">;</span></span>
<span id="cb60-26"><a href="#cb60-26"></a>        disk_controller<span class="op">.</span>operation_reg <span class="op">=</span> operation<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver-7" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb61" data-startFrom="27"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 26;"><span id="cb61-27"><a href="#cb61-27"></a>        disk_controller<span class="op">.</span>status_reg <span class="op">=</span> DISK_STARTED<span class="op">;</span></span>
<span id="cb61-28"><a href="#cb61-28"></a>        ready<span class="op">.</span>expect<span class="op">();</span></span>
<span id="cb61-29"><a href="#cb61-29"></a>        r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb61-30"><a href="#cb61-30"></a>    <span class="op">}</span></span>
<span id="cb61-31"><a href="#cb61-31"></a>    <span class="cf">return</span> r<span class="op">;</span></span>
<span id="cb61-32"><a href="#cb61-32"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="klasa-disk_driver-8" class="slide level2">
<h2>Klasa <code>Disk_driver</code></h2>
<div class="sourceCode" id="cb62" data-startFrom="33"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 32;"><span id="cb62-33"><a href="#cb62-33"></a><span class="at">static</span> Disk_driver disk_driver<span class="op">;</span></span></code></pre></div>
</section>
<section id="blokovski-ulaz-izlaz" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Klasa <code>Disk</code> opisuje rukovanje virtuelnim
(magneto-rotacionim) diskom.</li>
<li>Ova klasa definiše operacije <code>block_get()</code> i
<code>block_put()</code> koje omogućuju preuzimanje bloka sa diska i
smeštanje bloka na disk.</li>
<li>Prvi parametar ovih operacija pokazuje na niz od 512 bajta radne
memorije koji učestvuje u prebacivanju bloka, a drugi parametar određuje
broj bloka (u rasponu od 0 do 999).</li>
<li>Obe operacije su blokirajuće.</li>
</ul>
</section>
<section id="blokovski-ulaz-izlaz-1" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Pošto brzina pomeranja glave diska ograničava ukupnu brzinu diska,
važno je skratiti put koji glava diska prelazi.</li>
<li>Optimizacija kretanja glave diska je moguća kada se skupi, više
zahteva za čitanjem ili pisanjem.</li>
<li>Optimizacija se svodi na opsluživanje zahteva u redosledu staza na
koje se oni odnose, a ne u hronološkom redosledu pojave zahteva.</li>
<li>Na taj način se izbegava da glava diska osciluje između vanjskih i
unutrašnjih staza diska.</li>
</ul>
</section>
<section id="blokovski-ulaz-izlaz-2" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Da bi optimizacija kretanja glave diska bila moguća, neophodno je
uticati na redosled zahteva za čitanjem ili pisanjem blokova.</li>
<li>To postavlja specifične zahteve na implementaciju klase
<code>condition_variable</code> (proširenje klase).</li>
<li>Podrazumeva se da odabrani redosled deskriptora niti u listi uslova
nastaje na osnovu privezaka koji se dodeljuju svakom deskriptoru
prilikom njegovog uvezivanja u ovu listu.</li>
<li>Privesci imaju oblik neoznačenih celih brojeva, a njihovo
dodeljivanje deskriptoru omogućuje dodatni, drugi parametar operacije
<code>wait()</code>.</li>
</ul>
</section>
<section id="blokovski-ulaz-izlaz-3" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Uticaj na redosled deskriptora niti u listi uslova omogućuju
operacije <code>first()</code>, <code>next()</code> i
<code>last()</code> klase <code>condition_variable</code>.</li>
<li>Operacija <code>first()</code> omogućuje pozicioniranje pre prvog
deskriptora u listi uslova.</li>
<li>Operacija <code>next()</code> omogućuje pozicioniranje pre narednog
ili iza poslednjeg deskriptora u listi uslova.</li>
<li>Operacija <code>last()</code> omogućuje pozicioniranje iza
poslednjeg deskriptora u listi uslova.</li>
<li>Podrazumeva se da operacija <code>notify_one()</code> klase
<code>condition_variable</code> uvek izvezuje deskriptor sa početka
liste uslova.</li>
</ul>
</section>
<section id="blokovski-ulaz-izlaz-4" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Optimizaciju kretanja glave diska omogućuje operacija
<code>optimize()</code> klase <code>Disk</code>.</li>
<li>U situaciji kada je disk slobodan (kada polje state klase Disk
sadrži konstantu <code>FREE</code>), poziv operacije
<code>optimize()</code> dovodi do poziva blokirajuće operacije
<code>disk_driver.block_transfer()</code>.</li>
<li>U toku njenog izvršavanja disk je zaposlen (polje state sadrži
konstantu <code>BUSY</code>), a aktivnost pozivajuće niti je
zaustavljena.</li>
<li>Ako u ovoj situaciji više niti, jedna za drugom, pozove operaciju
<code>optimize()</code>, njihova aktivnost se zaustavlja, a njihovi
deskriptori se uvezuju u jednu od dve liste uslova, koje odgovaraju
polju <code>q</code> klase Disk.</li>
</ul>
</section>
<section id="blokovski-ulaz-izlaz-5" class="slide level2">
<h2>Blokovski ulaz-izlaz</h2>
<ul>
<li>Polje <code>index</code> ove klase indeksira ili listu uslova
namenjenu za deskriptore niti koje čitaju blokove između trenutnog
položaja glave diska i njegovog oboda ili listu uslova namenjenu za
deskriptore niti koje čitaju blokove između centra rotacije ploče diska
i trenutnog položaja njegove glave.</li>
<li>Podatak o trenutnom položaju glave diska (odnosno, o bloku koji se
upravo čita) sadrži polje <code>boundary</code> klase
<code>Disk</code>.</li>
<li>Polje <code>index</code> može imati vrednost 0 ili 1.</li>
<li>U pomenutim listama uslova deskriptori su poređani u rastućem
redosledu brojeva blokova koje niti čitaju (što je u skladu sa
optimizacijom kretanja glave diska).</li>
<li>Pomenuti brojevi blokova predstavljaju priveske deskriptora iz listi
uslova.</li>
</ul>
</section>
<section id="klasa-disk" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb63"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1"></a><span class="at">const</span> <span class="dt">int</span> DISK_ERROR <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="kw">class</span> Disk <span class="op">{</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>    mutex mx<span class="op">;</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>    <span class="kw">enum</span> Optimized_disk_state <span class="op">{</span> FREE<span class="op">,</span> BUSY <span class="op">};</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>    Optimized_disk_state state<span class="op">;</span></span>
<span id="cb63-7"><a href="#cb63-7"></a>    <span class="dt">unsigned</span> boundary<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk-1" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb64" data-startFrom="8"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 7;"><span id="cb64-8"><a href="#cb64-8"></a>    condition_variable q<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>    <span class="dt">int</span> index<span class="op">;</span></span>
<span id="cb64-10"><a href="#cb64-10"></a>    Disk<span class="op">(</span><span class="at">const</span> Disk<span class="op">&amp;);</span></span>
<span id="cb64-11"><a href="#cb64-11"></a>    Disk<span class="op">&amp;</span> <span class="kw">operator</span><span class="op">=(</span><span class="at">const</span> Disk<span class="op">&amp;);</span></span>
<span id="cb64-12"><a href="#cb64-12"></a>    <span class="dt">int</span> optimize<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">,</span></span>
<span id="cb64-13"><a href="#cb64-13"></a>                    Disk_operations operation<span class="op">);</span></span>
<span id="cb64-14"><a href="#cb64-14"></a><span class="kw">public</span><span class="op">:</span></span></code></pre></div>
</section>
<section id="klasa-disk-2" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb65" data-startFrom="15"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 14;"><span id="cb65-15"><a href="#cb65-15"></a>    Disk<span class="op">()</span> <span class="op">:</span> state<span class="op">(</span>FREE<span class="op">),</span> boundary<span class="op">(</span><span class="dv">0</span><span class="op">),</span> index<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="op">{};</span></span>
<span id="cb65-16"><a href="#cb65-16"></a>    <span class="dt">int</span> block_get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">);</span></span>
<span id="cb65-17"><a href="#cb65-17"></a>    <span class="dt">int</span> block_put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">);</span></span>
<span id="cb65-18"><a href="#cb65-18"></a><span class="op">};</span></span>
<span id="cb65-19"><a href="#cb65-19"></a></span>
<span id="cb65-20"><a href="#cb65-20"></a><span class="dt">int</span></span>
<span id="cb65-21"><a href="#cb65-21"></a>Disk<span class="op">::</span>optimize<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">,</span> Disk_operations operation<span class="op">)</span></span></code></pre></div>
</section>
<section id="klasa-disk-3" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb66" data-startFrom="22"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 21;"><span id="cb66-22"><a href="#cb66-22"></a><span class="op">{</span></span>
<span id="cb66-23"><a href="#cb66-23"></a>    <span class="dt">unsigned</span> tag<span class="op">;</span></span>
<span id="cb66-24"><a href="#cb66-24"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb66-25"><a href="#cb66-25"></a>    <span class="dt">int</span> status<span class="op">;</span></span>
<span id="cb66-26"><a href="#cb66-26"></a>    <span class="op">{</span></span>
<span id="cb66-27"><a href="#cb66-27"></a>        unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb66-28"><a href="#cb66-28"></a>        <span class="cf">if</span><span class="op">(</span>state <span class="op">==</span> BUSY<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
</section>
<section id="klasa-disk-4" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb67" data-startFrom="29"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 28;"><span id="cb67-29"><a href="#cb67-29"></a>            i <span class="op">=</span> index<span class="op">;</span></span>
<span id="cb67-30"><a href="#cb67-30"></a>            <span class="cf">if</span><span class="op">(</span>block <span class="op">&lt;</span> boundary<span class="op">)</span></span>
<span id="cb67-31"><a href="#cb67-31"></a>                i <span class="op">=</span> <span class="op">((</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">?</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">:</span> <span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb67-32"><a href="#cb67-32"></a>            <span class="cf">if</span><span class="op">(</span>q<span class="op">[</span>i<span class="op">].</span>first<span class="op">(&amp;</span>tag<span class="op">))</span></span>
<span id="cb67-33"><a href="#cb67-33"></a>                <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb67-34"><a href="#cb67-34"></a>                    <span class="cf">if</span><span class="op">(</span>block <span class="op">&lt;</span> tag<span class="op">)</span></span>
<span id="cb67-35"><a href="#cb67-35"></a>                        <span class="cf">break</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk-5" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb68" data-startFrom="36"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 35;"><span id="cb68-36"><a href="#cb68-36"></a>                <span class="op">}</span> <span class="cf">while</span><span class="op">(</span>q<span class="op">[</span>i<span class="op">].</span>next<span class="op">(&amp;</span>tag<span class="op">));</span></span>
<span id="cb68-37"><a href="#cb68-37"></a>            q<span class="op">[</span>i<span class="op">].</span>wait<span class="op">(</span>lock<span class="op">,</span> block<span class="op">);</span></span>
<span id="cb68-38"><a href="#cb68-38"></a>        <span class="op">}</span></span>
<span id="cb68-39"><a href="#cb68-39"></a>        state <span class="op">=</span> BUSY<span class="op">;</span></span>
<span id="cb68-40"><a href="#cb68-40"></a>        boundary <span class="op">=</span> block<span class="op">;</span></span>
<span id="cb68-41"><a href="#cb68-41"></a>    <span class="op">}</span></span>
<span id="cb68-42"><a href="#cb68-42"></a>    status <span class="op">=</span> disk_driver<span class="op">.</span>block_transfer<span class="op">(</span>buffer<span class="op">,</span></span></code></pre></div>
</section>
<section id="klasa-disk-6" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb69" data-startFrom="43"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 42;"><span id="cb69-43"><a href="#cb69-43"></a>                block<span class="op">,</span> operation<span class="op">);</span></span>
<span id="cb69-44"><a href="#cb69-44"></a>    <span class="op">{</span></span>
<span id="cb69-45"><a href="#cb69-45"></a>        unique_lock<span class="op">&lt;</span>mutex<span class="op">&gt;</span> lock<span class="op">(</span>mx<span class="op">);</span></span>
<span id="cb69-46"><a href="#cb69-46"></a>        state <span class="op">=</span> FREE<span class="op">;</span></span>
<span id="cb69-47"><a href="#cb69-47"></a>        <span class="cf">if</span><span class="op">(!</span>q<span class="op">[</span>index<span class="op">].</span>first<span class="op">())</span></span>
<span id="cb69-48"><a href="#cb69-48"></a>            index <span class="op">=</span> <span class="op">((</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">?</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">:</span> <span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb69-49"><a href="#cb69-49"></a>        q<span class="op">[</span>index<span class="op">].</span>notify_one<span class="op">();</span></span></code></pre></div>
</section>
<section id="klasa-disk-7" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb70" data-startFrom="50"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 49;"><span id="cb70-50"><a href="#cb70-50"></a>    <span class="op">}</span></span>
<span id="cb70-51"><a href="#cb70-51"></a>    <span class="cf">return</span> status<span class="op">;</span></span>
<span id="cb70-52"><a href="#cb70-52"></a><span class="op">}</span></span>
<span id="cb70-53"><a href="#cb70-53"></a></span>
<span id="cb70-54"><a href="#cb70-54"></a><span class="dt">int</span> Disk<span class="op">::</span>block_get<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">)</span></span>
<span id="cb70-55"><a href="#cb70-55"></a><span class="op">{</span></span>
<span id="cb70-56"><a href="#cb70-56"></a>    <span class="dt">int</span> status<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk-8" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb71" data-startFrom="57"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 56;"><span id="cb71-57"><a href="#cb71-57"></a>    status <span class="op">=</span> optimize<span class="op">(</span>buffer<span class="op">,</span> block<span class="op">,</span> DISK_READ<span class="op">);</span></span>
<span id="cb71-58"><a href="#cb71-58"></a>    <span class="cf">return</span> status<span class="op">;</span></span>
<span id="cb71-59"><a href="#cb71-59"></a><span class="op">}</span></span>
<span id="cb71-60"><a href="#cb71-60"></a></span>
<span id="cb71-61"><a href="#cb71-61"></a><span class="dt">int</span> Disk<span class="op">::</span>block_put<span class="op">(</span><span class="dt">char</span><span class="op">*</span> buffer<span class="op">,</span> <span class="dt">unsigned</span> block<span class="op">)</span></span>
<span id="cb71-62"><a href="#cb71-62"></a><span class="op">{</span></span>
<span id="cb71-63"><a href="#cb71-63"></a>    <span class="dt">int</span> status<span class="op">;</span></span></code></pre></div>
</section>
<section id="klasa-disk-9" class="slide level2">
<h2>Klasa <code>Disk</code></h2>
<div class="sourceCode" id="cb72" data-startFrom="63"><pre
class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 62;"><span id="cb72-63"><a href="#cb72-63"></a>    status <span class="op">=</span> optimize<span class="op">(</span>buffer<span class="op">,</span> block<span class="op">,</span> DISK_WRITE<span class="op">);</span></span>
<span id="cb72-64"><a href="#cb72-64"></a>    <span class="cf">return</span> status<span class="op">;</span></span>
<span id="cb72-65"><a href="#cb72-65"></a><span class="op">}</span></span>
<span id="cb72-66"><a href="#cb72-66"></a></span>
<span id="cb72-67"><a href="#cb72-67"></a>Disk disk<span class="op">;</span></span></code></pre></div>
</section></section>
<section>
<section id="pitanja" class="title-slide slide level1">
<h1>Pitanja</h1>

</section>
<section id="pitanja-1" class="slide level2">
<h2>Pitanja</h2>
<ul>
<li>Do čega dovodi pokušaj niti da preuzme znak kada je cirkularni bafer
drajvera tastature prazan?</li>
<li>Šta se desi kada se napuni cirkularni bafer drajvera tastature?</li>
<li>Šta se desi u obradi prekida diska?</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/math/math.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [
          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
